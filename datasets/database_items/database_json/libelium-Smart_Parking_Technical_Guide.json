{"nombre_pdf": "libelium-Smart_Parking_Technical_Guide", "modelo": "Cabina Smart Spot, Smart Parking Node", "proveedor": "Libelium", "equipo": "smart parking node", "precio": 875.15, "n_paginas": 78, "tablas": [], "resumenes": [], "texto": " Contents 1 Introduction 3 2 Network architecture 6 2.1 Smart Parking node . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6 2.2 LoRaWAN base station . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6 2.3 LoRaWAN Network Server . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7 2.4 Libelium Cloud . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7 3 Smart Parking node 8 3.1 Hardware description . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 8 3.1.1 Node versions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 9 3.1.2 Firmware versions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 9 3.1.3 LoRaWAN regions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 10 3.1.4 LoRaWAN protocol and parameters . . . . . . . . . . . . . . . . . . . . . . . . . . . 10 3.1.5 Identification label . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11 3.2 Power and time consumption . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11 3.2.1 Smart Parking EU . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11 3.2.2 Smart Parking US . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11 3.3 User switches . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 12 3.4 Reset button . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 12 3.5 Node setup . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13 3.5.1 \u201cReady to install\u201d state . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13 3.5.2 How to close the Smart Parking node . . . . . . . . . . . . . . . . . . . . . . . . . . 13 3.5.3 \u201cMagnet startup\u201d process . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 14 3.6 How the node works . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 15 3.6.1 Frame types . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 15 3.6.2 Node program execution . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17 3.7 Node parameters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17 3.7.1 Parameters description and ranges . . . . . . . . . . . . . . . . . . . . . . . . . . . 17 3.7.2 Understanding Info and Keepalive frames . . . . . . . . . . . . . . . . . . . . . . . 18 3.7.3 Understanding nightmode . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19 3.7.4 Understanding RTC synchronization . . . . . . . . . . . . . . . . . . . . . . . . . . 20 3.7.5 Understanding uplink frames format (real example) . . . . . . . . . . . . . . . . . . . 21 3.7.6 Factory default values . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21 3.7.7 Configure new parameter values . . . . . . . . . . . . . . . . . . . . . . . . . . . . 22 4 Smart Devices App 23 4.1 Configuring Smart Parking v2 parameters . . . . . . . . . . . . . . . . . . . . . . . . . . . 23 4.1.1 How to plug the Smart Parking node . . . . . . . . . . . . . . . . . . . . . . . . . . 23 4.1.2 Configuration . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 23 4.1.3 Programmer (change node parameters) . . . . . . . . . . . . . . . . . . . . . . . . . 25 4.1.4 Firmware upgrade . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26 4.1.5 Factory Reset . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 27 5 LoRaWAN Network Server setup 29 5.1 Loriot . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 29 5.1.1 Log in . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 29 5.1.2 Create a new Loriot application . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 29 5.1.3 Output data: Libelium Cloud URL . . . . . . . . . . . . . . . . . . . . . . . . . . . . 30 5.1.4 How to delete unused Loriot applications . . . . . . . . . . . . . . . . . . . . . . . . 32 5.1.5 How to create a single device manually . . . . . . . . . . . . . . . . . . . . . . . . . 32 5.1.6 Nodes batch provisioning in Loriot . . . . . . . . . . . . . . . . . . . . . . . . . . . 33 5.2 Actility . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 34 5.2.1 How to create a new Application Server . . . . . . . . . . . . . . . . . . . . . . . . . 35 5.2.2 How to create a new AS routing profile . . . . . . . . . . . . . . . . . . . . . . . . . 36 5.2.3 How to create new devices manually . . . . . . . . . . . . . . . . . . . . . . . . . . 38 5.2.4 Nodes batch provisioning in Actility . . . . . . . . . . . . . . . . . . . . . . . . . . . 40 5.3 Libelium Base Station . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 42 5.3.1 Supported LoRa Network Servers . . . . . . . . . . . . . . . . . . . . . . . . . . . . 42 5.3.2 Configure LoRaWAN Network Settings . . . . . . . . . . . . . . . . . . . . . . . . . 42 5.3.3 Register the gateway in Loriot . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 43 6 Cloud system 46 6.1 Libelium Cloud . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46 6.2 FIWARE . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46 6.3 Client third party platform . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 47 7 Deployment and installation 49 7.1 Stepbystep guideline . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 49 7.2 How to place the nodes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 49 7.3 Node installation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 50 7.3.1 Onsurface node installation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51 7.3.2 Semiunderground node installation . . . . . . . . . . . . . . . . . . . . . . . . . . . 55 7.4 Node startup . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 57 7.5 Working example . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 58 7.6 How to replace the battery . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59 8 Certifications 60 8.1 CE (European Union) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 60 8.2 FCC (United States) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 60 8.3 UKCA (UK) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 60 8.4 IP68 (EN 60529) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 60 8.5 IK10 (EN 50102) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 60 9 Maintance 61 10 Disposal and recycling 62 11 Safety Guides 63 11.1 Smart Parking Chemical Fixing Cartridge . . . . . . . . . . . . . . . . . . . . . . . . . . . . 64 12 Documentation changelog 76 1 Introduction The Smart Parking v2 solution developed by Libelium allows citizens to detect available parking slots. Figure 1.0.1: Smart Parking node developed by Libelium The Smart Parking device applies intelligent algorithms to detect changes in the state of the parking slot. Then data is transmitted across the LoRaWAN infrastructure to the LoRaWAN Network Server. Finally, the information is delivered to a final Cloud system. Figure 1.0.2: Smart Parking architecture One of the next Cloud system possibilities are available: [LISTA] Libelium Cloud (SaaS solution): Cloud provided by Libelium which allows the user to remotely configure the node parameters (sleep time, keepalive, nightmode, etc). That makes it possible to directly install the nodes with factory default settings and then update them from the server side. Both Loriot and Actility LoRaWAN Network Servers are supported. Also, visualization maps and Cloud connectors are provided. [LISTA] FIWARE (Onpremise solution): FIWAREbased platforms are supported always that ChirpStack LoRaWAN Network Server is used. If FIWARE platform is already provided by the client, then frame decoding and data treatment are provided by Libelium. On the other hand, a full FIWARE installation in the user\u2019s system is provided when needed. [LISTA] Client third party platform (Onpremise solution): Any Cloud or platform developed by the user which could provide database, visualization etc. In this scenario the LoRaWAN Network Server connection must also be developed. Frames decoding documentation is provided to the client when this option is chosen. Feature Libelium Cloud FIWARE Client 3rd party platform Server hosting SaaS Onpremise Onpremise Network Server Loriot or Actility ChirpStack Any integrated by the Client Visualization Yes Yes Must be developed by the Client Remote configuration Yes No Must be developed by the Client The devices\u2019 provisioning is very simple. The nodes are delivered with default program settings and unique LoRaWAN identifiers and keys. So it is easy to use the default settings to register all nodes in the LoRaWAN network server at a time. The Smart Parking node provides an outstanding detection performance thanks to its radar sensor. The next table shows a comparative analysis of the current sensor technologies in the Smart Parking market: Libelium Cloud remote parameter configuration: Figure 1.0.3: Libelium Cloud remote parameter configuration 2 Network architecture The network architecture of Smart Parking is based on the next elements: [LISTA] Smart Parking node [LISTA] LoRaWAN base station [LISTA] LoRaWAN Network Server [LISTA] Libelium Cloud Figure 2.0.1: Architecture of Libelium\u2019s Smart Parking solution 2.1 Smart Parking node The Smart Parking node is the device installed in each parking slot. When the device detects a change of the parking slot status (free/occupied), it sends a frame to the LoRaWAN base station. Figure 2.1.1: Smart Parking node 2.2 LoRaWAN base station The LoRaWAN base station (also known as gateway) must be installed in the surrounding area next to the parking nodes. It receives data and forwards it to the LoRaWAN Network Server. Libelium distributes base stations for LoRaWAN networks. All of them have LoRaWAN connection\u037e some feature Ethernet, WiFi or 4G connectivity too. Some base stations are ready to work outdoors (IP67 grade). Some of them come pre configured for certain LoRaWAN network servers (see next section). Also, some of them integrate an embedded LoRaWAN Network Server. Figure 2.2.1: LoRaWAN base station 2.3 LoRaWAN Network Server The nodes registration must be done in the Network Server in order to receive LoRaWAN data from all nodes in the network. Each node must be registered with an identifier and some encryption keys so the Network Server can receive and decrypt the packets successfully. The LoRaWAN Network Server purpose is to translate data from the LoRaWAN wireless network to an IP network. Therefore, when Smart Parking nodes packets are received, a callback is performed in order to send data to Libelium Cloud. 2.4 Libelium Cloud The LoRaWAN Network Server connects to the final server: Libelium Cloud. Libelium Cloud permits to receive, decode, store and exploit data. The user can also redirect data to a 3rd party IoT cloud (Amazon Web Services, Microsoft Azure, etc). This retransmission is done thanks to the cloud connectors running on Libelium Cloud. In addition, Libelium Cloud allows the user to update the settings of each parking node (sleep time, keepalive time, nightmode, etc). The update is done remotely via LoRaWAN downlink radio packets. Figure 2.4.1: Where Libelium Cloud sits in the complete solution 3 Smart Parking node 3.1 Hardware description The Smart Parking node is based on 2 different pieces: the base and the external enclosure. The base of the Smart Parking node includes the PCB, the battery, the antenna and the internal enclosure piece. The base is screwed to the external enclosure piece. The next table shows the basic Smart Parking node characteristics. Enclosure dimensions 200 x 200 x 37.25 mm Enclosure materials Polyamide, polypropylene and glass fiber Weight 0.813 kg (including installation accessories) 0.540 kg (just the Smart Parking node) Power supply Builtin lithiumthionyl chloride (LiSOCl2) batteries\u037e expected lifetime of 410 years* Configurable sleep time Min: 10 s / max: 10 min Radio protocol LoRaWAN module Dual detection Radar (main) and magnetic (backup) Provisioning Ready to install (factory LoRaWAN OTAA IDs and key are preconfigured to each node) Node configuration Via Libelium Cloud LoRaWAN configuration Via \u201cSmart Devices App\u201d (Java desktop application) Operating temperature 20 to +65 \u00b0C Market certifications CE (Europe) FCC (USA) UKCA Ingress protection certification IP68 (maximum rating against dust and water ingress) Impact protection certification IK10 (maximum rating against impacts) (*) Under normal circumstances and depending on settings (**) Continuous operation in extreme temperatures (high or low) is not recommended for long periods of time \u2013 for example, this may lead to reduced battery capacity, lower radar performance or random resets Figure 3.1.1: Vaulted enclosure dimensions The radar sensor performs a recalibration process periodically to deliver the most accurate measurement. It is an automatic feature, so no user action is required. Besides, this recalibration is internal, meaning it is always completed correctly, regardless of whether there is a vehicle above the node or not. 3.1.1 Node versions Libelium provides the next versions of Smart Parking: Reference Version Operating frequency SPEU Smart Parking EU 863.0 to 870.0 MHz (LoRaWAN EU863870) SPUS Smart Parking US 902.0 to 928.0 MHz (LoRaWAN US902928) SPAPLAAU Smart Parking APAC/LATAM/AU/AU915 915.2 to 927.8 MHz (LoRaWAN AU915928) SPIN Smart Parking IN 865.0 to 867.0 MHz (LoRaWAN IN865867) SPAPLAAS Smart Parking APAC/LATAM/AU/AS923 923 MHz (LoRaWAN AS923) 3.1.2 Firmware versions Firmware versions of Smart Parking nodes: Firmware version Description v1.0.x First Smart Parking node versions (deprecated) v1.1.1 First stable release in v1.1.x generation v1.1.2 Minimum sleep time from 20 to 10 seconds v1.1.3 Fixed LoRaWAN US manufacturer issues v1.1.4 Improved sensor measurement with high temperatures Firmware version Description v1.2.0 Improved power consumption in bad coverage behaviour and doubtful states. Update in frame header: recalibration bit to doubtful detection 3.1.3 LoRaWAN regions The Smart Parking node supports the next LoRaWAN regions: LoRaWAN region Supported by EU 863870 MHz ISM Band (Europe) Smart Parking EU US 902928 MHz ISM Band (United States) Smart Parking US AU 915928 MHz ISM Band (Australia) Smart Parking APAC / LATAM / AU / AU915 IN 865867 MHz ISM Band (India) Smart Parking IN AS 923 MHz ISM Band (Asia and ASEAN region) Smart Parking APAC / LATAM / AU / AS923 CN 779787 MHz ISM Band (China) Not available CN 470510 MHz ISM Band (China) Not available KR 920923 MHz ISM Band (South Korea) Not available 433 MHz ISM Band (Worldwide) Not available If you are interested in further information about LoRaWAN country regulations, please refer to the LoRa Alliance regional parameters document. 3.1.4 LoRaWAN protocol and parameters LoRaWAN is a Low Power Wide Area Network (LPWAN) protocol. It is a spreadspectrum modulation technique at extremely low datarates which permits sending data achieving long ranges. The most important LoRaWAN parameters are: [LISTA] LoRaWAN EUI: Readonly, 8byte, unique identifier which defines each LoRaWAN module in the market. [LISTA] Device EUI: Read/write, 8byte identifier configured into the LoRaWAN module to be used as operating identifier. By default, the \u201cLoRaWAN EUI\u201d of the module is factoryconfigured as \u201cDevice EUI\u201d in the Smart Parking node. [LISTA] Join mode: ABP or OTAA. Defines how the module joins the network. Different keys are needed for each method. [LISTA] Device address: Needed for ABP. The 4byte address of the the LoRaWAN module. Must be unique in its own subnetwork. [LISTA] Network Session Key: Needed for ABP. The 16byte AES key. Used to generate Message Integrity Check. [LISTA] Application Session Key: Needed for ABP. The 16byte AES key. Used to encrypt data. [LISTA] Application EUI: Needed for OTAA. The 8byte application identifier. Needed for opening an OTAA session and exchange encryption keys. [LISTA] Application Key: Needed for OTAA. The 16byte key. Needed for opening an OTAA session and exchange encryption keys. [LISTA] Datarate: Defines the transmission rate (bits per second). Each datarate settings combines different Spreading Factor (SF) and bandwidth (BW). By default, all LoRaWAN regions use the same datarate (DR 0). However, depending on the region, that means different SF and BW: \u2013 LoRaWAN EU863870 version: SF12 / 125 kHz \u2013 LoRaWAN IN865867 version: SF12 / 125 kHz \u2013 LoRaWAN AS923 version: SF12 / 125 kHz \u2013 LoRaWAN US902928 version: SF10 / 125 kHz \u2013 LoRaWAN AU915928 version: SF10 / 125 kHz [LISTA] ADR: Adaptive Data Rate setting which can be enabled or disabled. If ADR is enabled, the server will optimize the datarate based on the information collected from the network: the RSSI / SNR of the last received packets. If you are interested in further information about LoRaWAN specifications, please refer to the LoRa Alliance specifications document. 3.1.5 Identification label There is a sticker on the bottom side of the Smart Parking node base. In this sticker, several device specifications can be seen. For example the \u201cModel\u201d which refers to the device\u2019s region. Also, the unique \u201cLoRaWAN EUI\u201d is displayed so each node can be distinguished. Figure 3.1.2: Smart Parking node label 3.2 Power and time consumption The Smart Parking node firmware executes different steps since the node is started. Firstly, the node\u2019s setup and then an infinite loop where every cycle is based on measuring, sending if needed and sleeping. The next tables show the power and time consumption of each step modelled as a pulse of a specific time duration and average power consumption. 3.2.1 Smart Parking EU Power consumption Time consumption Node setup 22.9 mA 59 s Measure cycle 26 mA 340 ms Measure and send cycle 17 mA 6 s Sleep cycle 5.5 uA Depends on sleep time settings (*) LoRaWAN EU is set to the default SF12 settings (worst case). The send process may be lower power if the node is close to the base station. 3.2.2 Smart Parking US Power consumption Time consumption Node setup 21.8 mA 53 s Measure cycle 26 mA 340 ms Measure and send cycle 20 mA 3.6 s Sleep cycle 5.5 uA Depends on sleep time settings (*) LoRaWAN US is set to the default SF10 settings (worst case). The send process may be lower power if the node is close to the base station. 3.3 User switches The Smart Parking node has 2 switches to manage the working mode: [LISTA] On/Off switch: Determines whether the node is poweredon or poweredoff [LISTA] App/Boot switch: When the node is poweredon, this switch determines the performance state of the device \u2013 App position must be used for a normal operation mode, so the device executes the firmware within it \u2013 Boot position must be used for configuring purposes only Figure 3.3.1: Smart Parking node \u201cusers switches\u201d When the node is poweredon (On switch), you can change from App to Boot or viceversa by changing the state of the App/Boot switch. However, you must press the reset button to apply the operation mode change. Another possibility to successfully change the operation mode stepbystep would be to: power down the device (Off switch), change the App/Boot switch, press the reset button and then power on the device. Never leave the device set to On and Boot for more time than needed. The bootloader does not provide any sleep mode and it will waste the battery of the device. So when you finish reconfiguring the device, please set the node in off state. 3.4 Reset button The reset button can be used to restart the node in the corresponding operation mode (App or Boot). If the node is set up to \u201cApp\u201d (normal operation mode), pressing the reset button will restart the program execution. On the other hand, if the node is set up to Boot (configuration mode), pressing the reset button will restart the MCU bootloader for reconfiguration or firmware update. Figure 3.4.1: Reset button 3.5 Node setup 3.5.1 \u201cReady to install\u201d state Libelium provides the nodes \u201cready to install\u201d so the user only needs to install the nodes and follow the \u201cMagnet startup\u201d process. The Smart Parking node has a poweron process in order to put the device into a \u201creadytoinstall\u201d state: [LISTA] Step 1: The switches are set to \u201cApp\u201d and \u201cOff\u201d (press the reset button to make sure you discharge capacitors) [LISTA] Step 2: You power the device on by sliding the switch from \u201cOff\u201d to \u201cOn\u201d [LISTA] Step 3: Both LEDs (red and green) blink rapidly for 5 times [LISTA] Step 4: Red LED blinks once for 1 second to indicate that the device enters sleep mode for the 1st time. Now the node is in a \u201cready to install\u201d state. The customer should install the node on the real scenario and perform the \u201cMagnet startup\u201d process. Figure 3.5.1: \u201cReadytoinstall\u201d LED indication You can see how the previous steps are performed in this video: Ready to install process 3.5.2 How to close the Smart Parking node After following the previous steps, the device can be closed. In order to close the node correctly and ensure correct sealing, the following steps must be strictly followed. [LISTA] Step 1: Make sure that the screws have the orings to prevent water ingress. Figure 3.5.2: Screw swith oring [LISTA] Step 2: Ensure that the top surface of the gasket is clean and contains no foreign objects. [LISTA] Step 3: Place the inner casing inside the outer casing and make sure that the 2 position marks match. Figure 3.5.3: Enclosure position marks [LISTA] Step 4: Insert the screws and tighten them halfway. Figure 3.5.4: Screws in their position [LISTA] Step 5: Finally, tighten the 4 screws firmly. Do not use the maximum pressure (do not go all the way with the screws), because the orings could be ejected from the screws, and then the waterproof feature would NOT be valid. Besides, do not screw too hard and keep on screwing, because the screws could carve the female sockets, expanding their inner diameter\u037e this would cancel the waterproof quality too. Libelium manufactures and provides all nodes configured after following all explained steps, so the node is \u201cready to install\u201d. By factory default, all nodes are configured with their unique LoRaWAN EUI and random private keys. On the other hand, if different LoRaWAN parameters are desired, \u201cSmartDevicesApp\u201d must be used to change the settings and repeat the previously explained steps. 3.5.3 \u201cMagnet startup\u201d process Once the node has been set to \u201cready to install\u201d state and it has been closed and placed on the parking slot, the \u201cmagnet startup\u201d must be done. This process consists on resetting the device using the magnet for 3 consecutive times. Each magnet reset must be separated by at least one second period. The best way to proceed with the magnet is to go over the enclosure from left to right in a onemotion movement. Then wait for at least one second (although you can wait more) and proceed again until you complete 3 magnet resets. Figure 3.5.5: Magnet reset In the next videoclip you can see how the \u201cmagnet startup\u201d is performed: Magnet startup After finishing the \u201cmagnet startup\u201d, the node starts working normally for the rest of the time. No more threetime \u201cmagnet resets\u201d are needed in order to reset the device properly. So if a 4th magnet reset or software reset is applied, the device will reset and continue working normally again. The \u201cmagnet startup\u201d is only mandatory when the node is powered from a poweroff state. In other words, when the device is set to a \u201cready to install\u201d state. 3.6 How the node works 3.6.1 Frame types The Smart Parking architecture manages different uplink and downlink frames. The next table shows the uplink frames: Frame type Description Start frame 1 First frame sent by the node when starting (with params settings) Start frame 2 Second frame sent by the node when starting (with params settings) Info frame Used to inform a Parking Status change Keepalive frame Used to inform the device keeps working since last reported status Configuration uplink Used to confirm a \u201cConfiguration downlink\u201d was applied or not RTC update request Used to request for an RTC sync once every day The next table shows the downlink frames: Frame type Description Configuration downlink Used to update the node parameters. After the customer sets up a new node configuration in the Remote Configuration Form a new \u201cConfiguration downlink\u201d frame is enqueued into the LoRaWAN network server\u2019s downlink queue. RTC sync frame Used to sync the node\u2019s RTC to the server\u2019s timestamp. It is the mandatory response to \u201cStart frame 1\u201d and \u201cRTC update request\u201d uplink frames. The uplink frames are 11byte long to always comply with the LoRaWAN datarate worst case scenario. Their structure consists on 2 parts: header and payload. The \u201cheader\u201d format is always the same for all uplink frame types. On the other hand, the \u201cpayload\u201d format may be different for each frame type. Regarding the downlink frames, they have variable length and its format is private to the customer. The \u201cRTC sync frame\u201d is the mandatory response for both \u201cStart Frame 1\u201d and \u201cRTC update request\u201d frames. The \u201cRTC sync frame\u201d provides the server time to the nodes in order to keep the RTC updated. Also, the \u201cConfiguration downlink\u201d is an asynchronous frame sent by the server when the Remote Configuration Form is managed by the customer. You must keep in mind that when a downlink packet is requested there are usually some issues related to LoRaWAN network latency. This implies that the 1st request attempt usually fails. In that case, a 2nd attempt is sent in order to retrieve the lost downlink packet. For this reason, you might see that a couple of \u201cStart Frame 1\u201d or \u201cRTC update request\u201d frames are sent sequentially during the execution of the program. Libelium Cloud has the needed code to parse data inside frames into a more comprehensive structure. The cloud connectors also provide the needed tools to transmit the parsed data to a 3rd party IoT cloud. 3.6.2 Node program execution Figure 3.6.1: Smart Parking node program flow chart 3.7 Node parameters 3.7.1 Parameters description and ranges The Smart Parking node has different parameters that change the timing and detection performance of the node. The next table shows the node parameters: Parameter Range Description Sleep time 110 min or 1059 s Minutes or seconds elapsed between each measurement cycle Keepalive time 0.5, 1, 2,\u2026, 23 hour Hours elapsed since last uplink message which triggers a new Keepalive frame Nightmode 0 or 1 Nightmode disabled/enabled Nightmode start 0, 1,\u2026, 23 hour Nightmode starts when RTC reaches this parameter field Nightmode duration 1, 2,\u2026, 15 hour Nightmode period is equal to this field Nightmode sleep 1, 2,\u2026, 10 min Sleep time applied during nightmode Radar range start 20 to 50 cm Starting measurement distance (objects below this value are not detected) Radar range length 50 to 100 cm Range of measurement to be added to \u201crange start\u201d value Radar threshold 10 to 50 Threshold used in detection algorithm, so higher threshold imply less sensitive detection LoRaWAN join mode 0 (ABP) or 1 (OTAA) Join mode used by the LoRaWAN radio module LoRaWAN DevEUI 8byte identifier Defines the device EUI used by the LoRaWAN radio LoRaWAN DevAddr 4byte identifier Defines the device address used by the LoRaWAN radio in ABP mode LoRaWAN NwkSKey 16byte key Defines the LoRaWAN Network Session Key used by the LoRaWAN radio in ABP mode LoRaWAN AppSKey 16byte key Defines the LoRaWAN Application Session Key used by the LoRaWAN radio in ABP mode LoRaWAN AppKey 16byte key Defines the LoRaWAN Application Key used by the LoRaWAN radio in OTAA mode LoRaWAN AppEUI 8byte identifier Defines the LoRaWAN Application EUI used by the LoRaWAN radio in OTAA mode LoRaWAN port 1 to 223 Defines the port used for uplink sendings LoRaWAN ADR 0 (off) or 1 (on) Defines if Adaptive Data Rate is enabled or disabled LoRaWAN RX1 Delay 0 to 65536 Defines the delay after first LoRaWAN rx window LoRaWAN Subband 8bit bitmap Defines the subband used by the LoRaWAN radio (only applies to US and AU versions) The LoRaWAN identifiers and keys must be registered in the LoRaWAN network server before starting the node in order to receive data. For OTAA mode: DevEUI, AppEUI and Appkey. For ABP mode: DevEUI, DevAddr, NwkSKey and AppSKey. 3.7.2 Understanding Info and Keepalive frames In the regular working mode (daymode), \u201cSleep\u201d and \u201cKeepalive\u201d parameters are used. So the node normally sleeps for a specific \u201cSleep\u201d time then wakesup, measures and applies the algorithm detection in order to detect changes in the parking slot. If a change is detected from \u2018free\u2019 to \u2018occupied\u2019 or viceversa, then an \u201cInfo\u201d frame is sent. If no change occurred during the last \u201cKeepalive\u201d time, then a Keepalive frame is sent. Besides, if a sensor error is detected, a Keepalive frame sending is forced in order to inform about this issue. Example parameters used: [LISTA] Sleep: 7 minutes [LISTA] Keepalive: 1 hour Figure 3.7.1: Example Info and Keepalive frames 3.7.3 Understanding nightmode As shown in the parameters table, there are some parameters that allow the user to configure the node to use 2 working modes depending on time settings: daymode and nightmode. The nightmode is a secondary and optional working mode that allows the user to configure a different time basis parameters in order to reduce the battery impact. So, it was developed to use it when the parking slot is expected to have fewer changes (i.e. at night). Therefore, a different nightmode \u201cSleep\u201d setting is used. It is not mandatory to use the nightmode during night. This mode is thought to be used when less vehicle movement is expected in the parking slots. Which could be during day time. Example: [LISTA] Daymode: \u2013 Sleep: 1 minute [LISTA] Nightmode: \u2013 Nightmode start hour: 21 hours (9 PM) \u2013 Nightmode duration: 10 hours (Nightmode goes from 9 PM to 7 AM) \u2013 Nightmode sleep time: 10 minutes In the example, from 9 PM to 7 AM, the node will waste less battery because measurements are done every 10 minutes instead every minute. Keepalive events are not shown but a Keepalive event would be triggered if no change occurs in the parking slot. Figure 3.7.2: Example of day and night mode The conclusion is that the Nightmode is interesting for customers who certainly know the parking slot is expected to have fewer changes during large periods of time every day. From October 2019 the \u201ckeepalive nightmode\u201d setting was deprecated to simplify the parameter management. Since then, there is a single keepalive setting, for both \u201cnormal mode\u201d and \u201cnight mode\u201d. 3.7.4 Understanding RTC synchronization There are specific frame types that allow the node to synchronize the RTC to the server timestamp. The \u201cStart Frame 1\u201d expects an answer from the server with the timestamp (hours and minutes). This frame is sent after starting the node or a software reset. Besides, the node\u2019s firmware provides a mechanism which an \u201cRTC update request\u201d frame is sent every 24 hours since the node was started or reset. This frame waits for a downlink frame which brings the current server timestamp (hour and minutes). Figure 3.7.3: Example of RTC sync The RTC sync is important for Nightmode only where it mandatory to operate with a correct timestamp in order to enter and exit from nightmode to daymode and viceversa. 3.7.5 Understanding uplink frames format (real example) The next table shows all frames sent by a single node since it was started. The different columns display the parsed data from the received \u201cuplink data\u201d. Example: [LISTA] Daymode: \u2013 Sleep: 1 minute \u2013 Keepalive: 2 hour [LISTA] Nightmode: \u2013 Nightmode start hour: 22 hours (10 PM) \u2013 Nightmode duration: 8 hours (Nightmode goes from 10 PM to 6 AM) \u2013 Nightmode sleep time: 5 minutes It is possible to distinguish the starting frames at the beginning of the execution. Then the node informs with a new Keepalive every 2 hours. Any change of Parking slot status implies a new Info frame. And after 24 hours working, you can see the RTC request performed by the node. Timestamp F. Type Parking lot Battery Seq 04/15/19 15:59 4 (Start 1) Not available 0 0 04/15/19 15:59 5 (Start 2) Not available 0 1 04/15/19 15:59 1 (Keepalive) Free 0 2 04/15/19 17:29 1 (Keepalive) Free 0 3 04/15/19 19:29 1 (Keepalive) Free 0 4 04/15/19 21:29 1 (Keepalive) Free 0 5 04/16/19 23:29 1 (Keepalive) Free 0 6 04/16/19 01:29 1 (Keepalive) Free 0 7 04/16/19 03:29 1 (Keepalive) Free 0 8 04/16/19 05:29 1 (Keepalive) Free 0 9 04/16/19 06:04 0 (Info) Occupied 0 10 04/16/19 08:04 1 (Keepalive) Occupied 0 11 04/16/19 10:04 1 (Keepalive) Occupied 0 12 04/16/19 12:04 1 (Keepalive) Occupied 0 13 04/16/19 14:05 1 (Keepalive) Occupied 0 14 04/16/19 15:58 7 (RTC request) Occupied 0 15 04/16/19 15:59 7 (RTC request) Occupied 0 16 04/16/19 17:59 1 (Keepalive) Occupied 0 17 04/16/19 18:32 0 (Info) 0 0 18 04/16/19 20:02 1 (Keepalive) 0 0 19 04/16/19 22:32 1 (Keepalive) 0 0 20 04/17/19 00:02 1 (Keepalive) 0 0 21 3.7.6 Factory default values Libelium provides all Smart Parking nodes with factory default parameters. Parameter Default value Sleep time 1 min Keepalive time 2 hour Nightmode 0 (disabled) Nightmode start 0 hour Nightmode duration 6 hour Nightmode sleep 5 min Parameter Default value Radar range start 20 cm (should not be changed) Radar range length 60 cm (should not be changed) Radar threshold 30 (should not be changed) LoRaWAN join mode 1 (OTAA) LoRaWAN DevEUI unique factory default value LoRaWAN DevAddr, unique factory default value LoRaWAN NwkSKey unique factory default value LoRaWAN AppSKey unique factory default value LoRaWAN AppKey unique factory default value LoRaWAN AppEUI unique factory default value LoRaWAN port 3 LoRaWAN ADR 0 (off) LoRaWAN RX1 Delay 1000 (should not be changed) LoRaWAN Subband 8bit bitmap 3.7.7 Configure new parameter values Both Smart Devices App and Libelium Cloud allow the user to update program parameters to the node: [LISTA] Smart Devices App: it is a desktop Java application which implies opening the node enclosure and plug a microUSB cable to the node (the new configuration is flashed to the node\u2019s memory via the USB cable). [LISTA] Libelium Cloud: permits to remotely change some of the node parameters. Regarding the time and sensor parameters, the same values are set to all nodes manufactured by Libelium. The default values can be seen in the previous section. However, the customer can configure the time and sensor settings using both Smart Devices App and Remote Configuration Form. Regarding the LoRaWAN parameters, all keys are randomly generated for each node and kept secret. The DevEUI set to the node is the LoRaWAN hardcoded EUI which is unique for each radio chipset. However, the client can configure/modify all LoRaWAN parameters using the Smart Devices App only (the Remote Configuration Form does not permit it). For further information about this matter please refer to the \u201cSmart Devices App\u201d section. 4 Smart Devices App Smart Devices App is a software tool developed by Libelium that allows users to install new firmware versions and program the configuration of Libelium devices in few clicks. For further information (installation and execution) please refer to Smart Devices App manual: Smart Devices App (Binaries Updates) Figure 4.0.1: Smart Devices App is connected to the node via USB 4.1 Configuring Smart Parking v2 parameters 4.1.1 How to plug the Smart Parking node Before using the Smart Devices App, you must keep in mind how to plug and initialize it properly. As explained in the \u201cSmart parking node\u201d section, there are 2 switches to manage the node working mode. In order to use the node with the Smart Devices App, it is mandatory to set the node in \u201cBoot\u201d mode and then power it on. If you changed from \u201cApp\u201d to \u201cBoot\u201d mode, then you can use the reset button to apply the change and restart the node in the bootloader section. Never leave the device set to \u201cOn\u201d and \u201cBoot\u201d for more time than needed: the bootloader does not provide any sleep mode and it will waste the battery of the device. So when you finish reconfiguring the device, please set the node to \u201cOff\u201d state. 4.1.2 Configuration In the last tab, called Configuration, 2 parameters are available: \u201cUsername\u201d and \u201cPassword\u201d. These are the same credentials needed for the Libelium Cloud (https://cloud.libelium.com/app/login). Filling these fields is mandatory before start using the Smart Devices App with the Smart Parking node. Please remember to click the \u201cSave\u201d button at the bottom of the application to store the correct credentials. Figure 4.1.1: Configuration screen on Smart Parking v2 There are some differences between the 1st version and the 2nd one. In you must type your credentials to authenticate your nodes against the Libelium Cloud. You should have an account on the Libelium Cloud to get your username and password. 4.1.3 Programmer (change node parameters) Figure 4.1.2: Smart Parking v2 Programmer section Users can read and write all node parameters in this section. The process is quite simple: just connect the device to the computer where the is installed using the USB cable provided and switch on the node in \u201cBoot\u201d mode. Next, refresh the \u201cUSB settings\u201d section (bottomleft corner), clicking the \u201cRefresh\u201d button. Then select the port where the device has been connected. After that it is a good practice to hit the \u201cLoad from node\u201d button to get the current configuration from the connected device. Figure 4.1.3: Smart Parking v2 USB settings The \u201cLoad from node\u201d button will read all parameters from the node and will display the information on the app. On the other hand, the \u201cSend to node\u201d button will overwrite the configuration on the node. All available fields have to be filled with the proper format. If any parameter does not have an acceptable format, a red cross is displayed close to it, and you will not be able to write the information on the node. If the information introduced is valid, a green tick is shown. When loading/sending information to the node, the application will warn the user through a popup window about the status of the operation. Figure 4.1.4: \u201cLoad configuration from node\u201d & \u201cSend configuration to node\u201d buttons Smart Parking v2 shares most of the configuration fields with . However, it is important to know the purpose for each field on the configuration. To know more about each field and how they work, please refer to the chapter \u201cSmart Parking node\u201d. Configuring a \u201csleep time\u201d less than 1minute period importantly decrease the battery life. 4.1.4 Firmware upgrade Inside this tab, users can select the firmware version to install in their devices. Figure 4.1.5: Firmware update and factory reset section for Smart Parking v2 The list with all available firmware is loaded when the program starts, but users can manually update it by clicking on the \u201cSearch new firmware updates\u201d button. Before installing the firmware, it is necessary to download it. This process is very simple, just mark the check of the version you want to install from the list and click on \u201cDownload checked\u201d. It is mandatory to perform a configuration load from node using the button available in tab before updating the firmware. This information load will check the current configuration before updating the firmware. To summarize, the steps are: 1. Check your firmware version in the Programmer tab before flashing a new firmware: 1. Nodes with firmware v1.1.x are compatible with firmwares v1.1.x and v1.2.x 2. Nodes with firmware v1.0.x are only compatible with firmwares v1.0.x 2. Click the \u201cSearch new firmware updates\u201d button to load new firmware updates 3. Check one or more firmwares to download from the firmware list on the left side 4. Click on \u201cDownload checked\u201d to download the selected firmwares Figure 4.1.6: Download new firmware versions Now the firmware files are downloaded. The dropdown menu will show the available firmware files to be installed on the node. When the file is downloaded, a disk icon is displayed close to it, indicating it is downloaded. On the \u201cInstall Firmware\u201d section you can select the firmware to install and then hit on \u201cInstall\u201d to execute the installation. The app will display a popup message for the status of the firmware installation. Remember that the USB port must be selected in the programmer tab. Figure 4.1.7: Firmware installation You can also delete the downloaded firmware files by selecting the check box from the list and then clicking on the \u201cDelete checked\u201d button. 4.1.5 Factory Reset The Factory Reset is the last option to recover a nonworking Smart Parking v2 device. It performs a full reset followed by a firmware and configuration reset. To get the recovery configuration file, send an email to pointing your order number and the Technical Service Team will send the configuration file needed. For this process it is mandatory to download a firmware, as explained on the previous section \u201cFirmware upgrade\u201d. Then select a firmware from the dropdown menu and press the \u201cFactory Reset\u201d button. Figure 4.1.8: Factory reset process for Smart Parking v2 Step1 Pressing the \u201cFactory Reset\u201d button will display a file explorer window to select the configuration file provided by Libelium. Once you selected this file, a message will show up asking if you want to start the process. If the \u201cYes\u201d option is selected, the Factory Reset process starts. Figure 4.1.9: Factory reset process for Smart Parking v2 Step2 When the Factory Reset finishes, another message informs about the final result: Figure 4.1.10: Factory reset finished for Smart Parking v2 After this process, you can configure your node again on the \u201cProgrammer\u201d tab. 5 LoRaWAN Network Server setup Libelium currently supports several LoRaWAN Network Server services. In this section, we explain how to set them up. Remember that any LoRaWAN network needs a Network Server, so you have to choose one of the options above. Not only Libelium\u2019s Smart Parking nodes need a Network Server: any LoRaWAN device (by Libelium or other company) needs a Network Server, it\u2019s just one piece of the LoRaWAN architecture. 5.1 Loriot This section explains how to route the information on Loriot to Libelium Cloud using the HTTPS protocol. The free \u201cCommunity account\u201d does not permit remote downlinks. Therefore, a Commercial license should be purchased in order to use remote downlink messages for RTC sync, nightmode feature and node parameter update via Remote Configuration Form. 5.1.1 Log in Log in in the Loriot platform, selecting your server location. Figure 5.1.1: Loriot login web page 5.1.2 Create a new Loriot application Once you selected the server location, a new prompt will be displayed asking your credentials. After logging in, users have to create a new application in the Loriot dashboard. To do this it is necessary to click on \u201cAppli cations\u201d in the left side bar and then in \u201cNew Application\u201d option located in the same bar: Figure 5.1.2: Creating an application Fill the form in order to create the desired application in Loriot: [LISTA] New application name: Name to identify the application. [LISTA] Output format: \u201cWebsocket\u201d is selected by default and it is not possible to change it in this form. How to change it will be explained in the following step. [LISTA] Device capacity: Maximum number of devices to be registered in this application. The maximum value will depend on the account type you have. [LISTA] Visibility: This checkbox permits to set the application as \u201cpublic\u201d or \u201cprivate\u201d. Figure 5.1.3: New application form 5.1.3 Output data: Libelium Cloud URL Once the application is created, the dashboard will be shown. Go to \u201cApplication Outputs\u201d > click on \u201cManage outputs\u201d > click on \u201cAdd new output\u201d: Figure 5.1.4: Create a new application output Select \u201cHTTP Push\u201d from the list and fill the form displayed on the right side. In the \u201cTarget URL for POSTs\u201d field, write the URL where Loriot must send data to (https://api.libelium.com/cloud/parking/v2/services/loriot). Besides, users can add an authorization header in \u201cCustom Authorization header value\u201d in order to increase the security in the communications, so the final server only accepts the information from an authorized account. Finally, click on the \u201cConfirm change\u201d button to save the information. Figure 5.1.5: Loriot HTTP Push configuration For that purpose, you can generate your own Libelium API key in the corresponding Cloud section: 5.1.4 How to delete unused Loriot applications A list with all application outputs will be displayed in the \u201cApplication Outputs\u201d window. It is recommended to delete unused outputs and keep only \u201cHTTP Push\u201d in the list. The procedure to delete all other applications is to click on the desired ellipsis button of the application \u201c\u2026\u201d and select \u201cDelete\u201d option. A popup window will ask you to confirm the operation. Figure 5.1.6: Delete unused application outputs 5.1.5 How to create a single device manually Click on \u201cDevices\u201d left menu to show the device list. Click on \u201cEnroll new device\u201d button to add a new device: Figure 5.1.7: Enroll new device A new form will be displayed in order to create the new device associated to the application. In this form it is possible to choose different enrolling processes based on OTAA or ABP. So, depending on the option chosen, it will be mandatory to insert different EUIs or keys. Please refer to \u201cLoRaWAN protocol and parameters\u201d to understand the all parameters involved in this form. Figure 5.1.8: New device form 5.1.6 Nodes batch provisioning in Loriot Inside the Loriot application click on \u201cBulk import\u201d and then click on \u201cUpload file\u201d to register several devices at a time. It asks for a CSV file which must be exported from the SCM. Please refer to \u201cLibelium Cloud\u201d section for further information on how to export this CSV file which includes all nodes OTAA credentials needed for direct batch import. Figure 5.1.9: Loriot bulk import The CSV file for \u2018N\u2019 devices must respect the next format: <DevEUI_1>,<AppEUI_1>,<AppKey_1>,<Serial_1> <DevEUI_2>,<AppEUI_2>,<AppKey_2>,<Serial_2> <DevEUI_3>,<AppEUI_3>,<AppKey_3>,<Serial_3> ... <DevEUI_N>,<AppEUI_N>,<AppKey_N>,<Serial_N> 5.2 Actility This section explains how to route information on Actility to Libelium Cloud using the HTTPS protocol. Firstly, you must access into the Actility\u2019s ThingPark portal and log in. IN the main portal, you must go to \u201cThingPark Application\u201d section and access to \u201cDevice Manager\u201d: Figure 5.2.1: Access to \u201cDevice Manager\u201d menu Actility requires an \u201cApplication Server\u201d and an \u201cAS routing profile\u201d in order to establish the communication with Libelium Cloud. These 2 elements are required before starting the service the 1st time, and will be the base to create new devices. 5.2.1 How to create a new Application Server Starting from the main ThingPark Device Manager window, you shall create a new \u201cApplication Server\u201d by clicking on \u201cApplication Servers\u201d: Figure 5.2.2: Device Manager menu The first section allows you to create a new \u201cApplication Server\u201d. Then the second section shows a list of all \u201cApplication servers\u201d created. Click on the \u201cCreate\u201d button in the first section to create a new \u201cApplication Server\u201d: Figure 5.2.3: Application servers menu In \u201cName\u201d field define your Application server name. In \u201cType\u201d field, you must select \u201cHTTP Application Server\u201d. Finally, click on the \u201cCreate\u201d button to continue: Figure 5.2.4: Application server name A new window appears, where the name is copied from the previous popup. In the \u201cContent Type\u201d field you must select \u201cJSON\u201d. Then click on the \u201cAdd\u201d button in \u201cAdd a route\u201d section to create the link to the callback server installed: Figure 5.2.5: Application server form A \u201cRoute\u201d section will be generated with a new form to be completed. Just click the \u201cAdd\u201d button to proceed: Figure 5.2.6: Route form A new popup appears. In the \u201cDestination\u201d field, you must enter the URL of the server where the data is going to be sent (https://api.libelium.com/cloud/parking/v2/services/actility). Click on the \u201cAdd\u201d button to save the information: Figure 5.2.7: Destination form Navigate back to the Application server form, click on \u201cSave\u201d in order to create the \u201cApplication server\u201d. 5.2.2 How to create a new AS routing profile The Application Server (AS) routing profile defines how a previously created \u201cApplication server\u201d will behave. In order to create a new \u201cAS routing profile\u201d in the Device Manager, click on \u201cAS routing profiles\u201d button on the left sidebar menu: Figure 5.2.8: Destination form Then you must click on the \u201cAdd\u201d button in the first section. Below, in the second section, a list with all existing \u201cAS routing profiles\u201d will be displayed: Figure 5.2.9: AS Routing profiles In the \u201cName\u201d field write the name of the AS routing profile. In the \u201cType\u201d field, select LoRaWAN. Then click on the \u201cCreate\u201d button to continue the process: Figure 5.2.10: AS Routing profile name In the new window, you can read the \u201cAS routing profile ID\u201d which will be needed for batch import. Besides, mark the check \u201cIs default\u201d and click the \u201cAdd button\u201d: Figure 5.2.11: AS Routing profile route A new popup will appear with 2 parameters to be completed. \u201cType\u201d is the kind of the application for our destination, \u201cLocal application server\u201d must be selected. In the \u201cDestination\u201d dropdown field, all available Application servers will be displayed. So, the correct \u201cApplication server\u201d previously created must be selected: Figure 5.2.12: Add the created Application server as \u201cdestination\u201d for the routing profile Navigate back to the AS routing profile form, click on \u201cSave\u201d in order to create it. This process should be completed just once. From this moment, customers can add devices to the service. 5.2.3 How to create new devices manually Once created the \u201cApplication server\u201d and \u201cAS routing profile\u201d, you can create new devices. In the main ThingPark menu, click on \u201cDevices\u201d option . Then click on the \u201cCreate\u201d button: Figure 5.2.13: Create new devices A new form will be displayed in order to define the new device\u2019s parameters: Administrative data [LISTA] Device name: Name to identify the device [LISTA] Marker: Icon to identify the device on the map list [LISTA] Administrative info: Relevant information of the device [LISTA] Administrative location: Location of the device [LISTA] Motion indicator: List with several options Device identification [LISTA] Manufacturer: Select \u201cGeneric\u201d. [LISTA] Model: Select the corresponding region: \u2013 LoRaWAN EU863870: LORA/GenericA.1.0.2a_ETSI_Rx2SF12 \u2013 LoRaWAN US902928: LORA/GenericA.1.0.2a_FCC_Rx2SF12 \u2013 LoRaWAN IN865867: LORA/GenericA.1revB_IN865_Rx2SF12 \u2013 LoRaWAN AU915928: LORA/GenericA.1revB_AU915_Rx2SF12 \u2013 LoRaWAN AS923: LORA/GenericA.1_AS923_Rx2SF10 [LISTA] Device activation: Select \u201cOver The Air Activation (OTAA)\u201d if default parameters are used. ABP is the other option. [LISTA] DevEUI: Device EUI, globally unique IEEE EUI64 address. [LISTA] AppEUI: Device Application identifier (mandatory for OTAA). [LISTA] Key format: Should be \u201cClear text\u201d for nonencrypted key format. [LISTA] AppKey: 16byte Application Key (mandatory for OTAA). Network parameters [LISTA] Connectivity plan: Select a Connectivity plan on the dropdown menu. [LISTA] DevAddr: Select \u201cAllocated by the network server\u201d. Application layer handling [LISTA] Application server routing profile: Select the \u201cApplication server\u201d created before. Figure 5.2.14: Enter all device\u2019s parameters Finally click on the \u201cCreate\u201d button in order to save the information of the device. 5.2.4 Nodes batch provisioning in Actility It is possible to register several nodes at a time using the \u201cImport\u201d button: Figure 5.2.15: Import devices A new window is displayed in order to import a CSV file with all devices to be imported: Figure 5.2.16: Import CSV file Regarding the CSV file format, you must start from the exported CSV file from the SCM. Please refer to \u201cLibelium Cloud management\u201d section for further information on how to export this CSV file which includes all nodes OTAA credentials needed for direct batch import. Then, you must keep in mind that Actility needs more information to be included in that CSV file. The CSV to be imported must follow the next format (15 columns). The CSV file for \u2018N\u2019 devices must respect the next format: Where: [LISTA] CREATE_OTAA: Should always be the same in order to import the devices using OTAA join mode. [LISTA] <DevEUI>: This is the Device EUI exported from Libelium SCM CSV file. Should not be changed. [LISTA] <DevPofile>: This field is related to the LoRaWAN region of the node. Possibilities depending on the version: \u2013 LoRaWAN EU863870: LORA/GenericA.1.0.2a_ETSI_Rx2SF12 \u2013 LoRaWAN US902928: LORA/GenericA.1.0.2a_FCC_Rx2SF12 \u2013 LoRaWAN IN865867: LORA/GenericA.1revB_IN865_Rx2SF12 \u2013 LoRaWAN AU915928: LORA/GenericA.1revB_AU915_Rx2SF12 \u2013 LoRaWAN AS923: LORA/GenericA.1_AS923_Rx2SF10 [LISTA] <AppEUI>: This is the Application EUI exported from Libelium SCM CSV file. Should not be changed. [LISTA] <AppKey>: This is the Application Key exported from Libelium SCM CSV file. Should not be changed. [LISTA] <AS_profile_ID>: This is Actility\u2019s \u201cAS routing profile ID\u201d which belongs to each customer\u2019s account. It can be read from the profile when it is first created. [LISTA] <ConnPlan>: This must be set as \u201cdevcs/testing\u201d. [LISTA] <Name>: Name of each device (optional). Example for some Smart Parking EU nodes (LoRaWAN EU863870). Let\u2019s assume TWA_123 was the \u201cAS routing profile ID\u201d given by Actility for our application: 5.3 Libelium Base Station This section explains how to route information on a Libelium Base Station to Libelium Cloud using third party Network Servers. 5.3.1 Supported LoRa Network Servers This LoRaWAN Gateway can be configured in several ways to route LoRa data to different Network Servers. This section is focused on the configuration of the gateway to connect to Libelium\u2019s Cloud through the Loriot Network server. The Manufacturer\u2019s documentation might help customers from the very first moment to access to the device and deploy their own network here. 5.3.2 Configure LoRaWAN Network Settings In order to connect to Loriot the Semtech Packet Forwarder installed in the gateway. It can be selected and configured in the LoRa Network > Nertwork Settings section. The Server address will be the same where the Network and Application of the customer\u2019s account is created. Up and down port must be set to 1780. Figure 5.3.1: LoRaWAN Network Settings 5.3.3 Register the gateway in Loriot Adding a new gateway in Loriot provides several models, amongst which the user must chose. Although this gateway model is not among them, the Semtech Packet Forwarder is available for the user to configure with this gateway: Figure 5.3.2: Loriot Gateway Registration To connect the gateway to Loriot, the physical MAC address and Gateway EUI must be set in the register process. Figure 5.3.3: Loriot Gateway Registration The device MAC adress can be found in the Network > WAN Interface section. Figure 5.3.4: Loriot Gateway Registration The Gateway EUI can be found in the LoRa Network > Network Settings section. Figure 5.3.5: Loriot Gateway Registration After registration, frecuency plan can be configured in the gateway section. Figure 5.3.6: Loriot Gateway Registration 6 Cloud system Cloud system options: Figure 6.0.1: Smart Parking architecture 6.1 Libelium Cloud Libelium Cloud features: [LISTA] SaaS solution [LISTA] Store, visualize and analyze the data received from your Air Quality Station devices. [LISTA] Remotely manage all your devices. [LISTA] Get LoRaWAN encryption keys. [LISTA] Connectors to send data to Clouds in the market: Amazon Web Services, Microsoft Azure,\u2026 Figure 6.1.1: Libelium Cloud 6.2 FIWARE FIWARE features: [LISTA] Onpremise solution [LISTA] ChirpStack as LoRaWAN Network Server [LISTA] Visualization provided Figure 6.2.1: FIWARE as Cloud platform Figure 6.2.2: Visualization provided by Libelium in FIWARE solutions 6.3 Client third party platform Client third party platform features: [LISTA] Onpremise solution [LISTA] Any LoRaWAN Network Server managed by the user [LISTA] Frames decoding documentation is provided by Libelium Figure 6.3.1: Client third party platform Warning: Database managementent, Visualization and Remote Configuration must be developed by the Client 7 Deployment and installation 7.1 Stepbystep guideline Once you receive the Smart Parking batch, the steps involved in the deployment of the network are: 1. Nodes provisioning: Once the client owns a LoRaWAN Network Server license, it is mandatory to register the nodes with the configured identifier and keys for each node. The client must decide whether they use the factory default LoRaWAN unique identifier and random private keys provided by Libelium or they prefer to configure their own identifier and keys. You must keep in mind that every node is provided \u201cready to install\u201d with factory default identifier and keys. If clientconfigured identifier and keys are desired, then each node will have to be configured separately using the Smart Devices App. This 2nd option increases the provisioning time. So Libelium recommends using the default IDs and keys. If factory default keys are used, then a CSV file exported from Libelium Cloud can be used to ease the bulk import into the LoRaWAN Network Server. Find the factory default IDs/keys in the Node keys tool section. Please refer to the \u201cSmart Devices App\u201d chapter for further information about the Smart Devices App. 2. Libelium Cloud: It is used to receive, store and exploit data. The user can also perform remote configuration of nodes and forward data to a 3rd party cloud. The LoRaWAN Network Server must be configured to properly forward all packets to Libelium Cloud. 3. Nodes installation: Each node must be placed on the proper parking slot and then follow the \u201cmagnet startup\u201d protocol explained in the \u201cMagnet startup procces\u201d section. Figure 7.1.1: Smart Parking network architecture 7.2 How to place the nodes The correct installation spot is the center of the parking slot to ensure the best detection. It is possible to install the nodes on different parking slot configurations: [LISTA] Parallel [LISTA] Perpendicular [LISTA] Angled Figure 7.2.1: Parallel parking slots Figure 7.2.2: Perpendicular parkings lots It is important to keep in mind that parking slots must be delimited by lines so the node is placed in the center of the parking area. Placing the nodes with no line definitions may lead into bad behaviour. 7.3 Node installation The user can choose among different types of installation for the node. This table summarizes pros and cons: Onsurface installation Semiunderground installation Type of enclosure Vaulted Vaulted Presence of node over the ground Full node (40.25 mm) Part of node (6 mm) Rain immunity Yes Yes Puddle immunity Yes Yes Vandalism/robbery immunity Medium High Snowplow immunity No Possible Installation process, Fast and easy Special tools needed Tools needed Normal drill Industrial big crown drill. Epoxy. Can be dismantled for maintenance Yes No Note: Since 2022, the \u201cUnderground\u201d installation type is no longer supported. 7.3.1 Onsurface node installation Figure 7.3.1: Step by step chemical fixing and anchor installation Firstly, mark 4 holes in the asphalt. Select an area as flat and regular as possible, avoid irregularities on the terrain. You should place the enclosure in the final location and use the 4 holes as a reference to drill 4 little marks on the ground. You can also draw 4 dots with ink. Figure 7.3.2: Marking the holes for the node Then continue with the chemical fixing installation step by step as described above. Also, in the next video you can see how the installation is done chemical fixing installation. Step 1: Drill the holes. The drill diameter must be W=14 mm minimum. Try to drill as vertical as possible to enable the best enclosure installation. The length of the hole must be about H=85 mm. Step 2, 3 and 4: Blow out dust and loose materials. Remove all the dust and little rocks inside the 4 holes, created during the drilling operation. This is important to allow the anchors go all the way down. You can clean each hole mechanically and then use a bottle of spray duster (highpressure air bottle). Make sure that the real depth of the hole is enough. Step 5: Inject the chemical fixing. The chemical fixing shall be injected into the 4 holes carefully. You must keep in mind that this chemical adhesive must fill the complementary space the anchor leaves in the hole. So the whole hole does not have to be fully filled with adhesive because there is no space left for the anchor. The chemical adhesive quantity to be injected will depend on the dimensions of the holes. Step 6: Insert the anchors. Once the adhesive is injected, the anchor must be carefully inserted into the hole. Rotating the anchor by hand while inserting it is a good practice. Therefore, the adhesive fills and completes all the empty space left by the anchor in the hole. Once the anchor is correctly inserted, some adhesive might exceed from the hole. This residuary adhesive must be removed from the installation so the are no extra adhesive and the anchor installation is clean and smooth. Step 7: Finish anchors installation. The anchors have an internal thread to screw the screws. Inserting the anchors with the screws partially inserted might be a good practice in order to place the anchor correctly aligned within the hole (that means you can use the screw as a tool if it is partially inserted inside the anchor). Also, if the screw is inside the anchor, avoids that the adhesive accidentally gets inside the anchor. After cleaning the remaining adhesive from the hole, the user must wait some time until the chemical resin is solid and stable. After this period of time, the screws can be removed from the anchors and the installation is finished. Step 8: Place the node. Place the black rubber circle on the ground. To enable the correct screwing of the screws inside the anchors, make sure that there is no dust in the internal thread of the anchor. Install the node in its final position and screw the 4 special (antivandalism) screws provided. Antivandalism screws are recommended to avoid problems: anyone could unscrew a node if fixed with standard screws. 7.3.2 Semiunderground node installation This is a possible installation in order to provide vandalism immunity and also rain/puddle immunity. So the node partially inserted in the ground and the vaulted enclosure minimizes the water issues. Regarding the installation process, the next steps explain how to correctly install the device: Step 1: Drill the hole. Use a hole saw or other dedicated tool to drill a hole into the pavement bigger enough for the enclosure (minimum diameter 202 mm). Try to perforate it deep enough to insert the Smart Parking node completely without rising over the surface, be sure that the enclosure remains under the pavement line approximately 10 mm. Figure 7.3.3: Making a hole in the pavement Step 2: Place the node into the pavement hole. Below the device, a layer of cement must be spread to elevate the device to the correct horizontal position independently of the depth of the hole. The diameter of the hole must be at least 202 mm. Step 3: Fill the hole. Finally, the node needs to be fixed to the pavement using Epoxy resin (commonly used for filling road fissures). This resin should fill all the space between enclosure and pavement. Also, it should completely cover the top of the enclosure ensuring protection against water, bad environmental conditions and vandalism. The Epoxy resin tested by Libelium provides a curing time around 612 hours at 20 \u00baC and RH 50%. So the parking installation must not be used prior this curing time. In this installation, it is crucial that the upper side of the enclosure is not covered with Epoxy or other material. Only the side slides can be covered, the center of the node must be clean to allow the radar signal work properly. In the node placement step, the vaulted enclosure must exceed the horizontal pavement layer by 67 mm approximately. The next figure shows how the node is placed: Figure 7.3.4: Semiunderground node installation Step 4: Start the node using the magnet. Proceed with the \u201cMagnet startup\u201d process in order to initialize the node. 7.4 Node startup After the node is installed, you must follow the \u201cMagnet startup\u201d steps explained in the \u201cMagnet startup process\u201d section. This process is based on 3 consecutive magnet resets waiting at least one second between each reset. In the future need of resetting the node manually, just a single magnet reset will be needed. Once the node has been started, it will begin to run the firmware stepbystep as explained in the \u201cHow the node works\u201d section. In the next video you can see how the \u201cmagnet startup\u201d is performed: magnet startup. Figure 7.4.1: Using the magnet to start the node 7.5 Working example The next diagram explains how the node program works when the node is installed and started when the parking slot is free. On the left column you can see the parking slot status during the execution. On the right side you can see the frame types that are sent to Libelium Cloud depending on parking slot status changes, elapsed time and user configuration changes. Figure 7.5.1: Smart Parking node working example 7.6 How to replace the battery Battery replacement procedure 8 Certifications 8.1 CE (European Union) Go to CE Declaration of Conformity 8.2 FCC (United States) \u201cSmart Parking v2 US\u201d complies with Title 47 Part 15 subpart B of the FCC rules and regulations for Radio Frequency Devices \u2013 Unintentional Radiators (2019). This device contains the following transmitter modules: [LISTA] FCC ID: T9JRN2903 [LISTA] FCC ID: 2AQ6KA1 8.3 UKCA (UK) Go to UKCA Declaration of Conformity 8.4 IP68 (EN 60529) \u201cSmart Parking v2\u201d was tested according to the standards UNEEN 60529:2018 + /A1:2018 + /A2:2018 (EN 60529:1991 + Erratum:1993 + /A1:2000 + /A2:2013). Protection against solid foreign objects The node was introduced inside an IP6X dust chamber for 8 hours, with talcum powder 2 kg/m and an internal 20 mbar pressure depression. After tests, no traces of dust were found inside the enclosure, proving an IP6X degree of protection. IP6X is the maximum rating for protection against solid foreign objects. Protection against ingress of water The node was introduced inside an immersion tank for 30 minutes. This test was performed with the lowest point of the enclosure at 1.2 m below water surface. After tests, no water traces observed inside the enclosure, proving an IPX8 degree of protection. IPX8 is the maximum rating for protection against ingress of water. 8.5 IK10 (EN 50102) \u201cSmart Parking v2\u201d was tested according to the standards UNEEN 50102:1996 + A1:1999 + Corr:2002 + A1 CORR:2002 (EN 62262:2002). The node was submitted to 20 J impacts in several points of the enclosure (the equivalent to the impact of a 5 kg mass dropped from 400 mm above the impacted surface). After tests, no cracks nor holes were observed on the tested samples, proving an IK10 degree of protection. IK10 is the maximum rating for protection against external mechanical impacts. If you want to know more about certifications please refer here. 9 Maintance [LISTA] In this section, the term \u201cSmart Parking\u201d encompasses both the device itself as well as its accessories. [LISTA] Although Smart Parking is a highly resistant product, please handle with care in order to enjoy a longer useful life. [LISTA] Handle Smart Parking with care, do not allow it to drop or move roughly. [LISTA] Avoid placing the devices in areas reaching high temperatures that could damage the electronic components. [LISTA] Avoid aggressive environments (corrosive gases, animals, excessive/condensing humidity or atmospheres with salt suspended in the air). [LISTA] The antenna and battery connect on gently to their connectors, do not force upon installing or you could damage the connector. [LISTA] Plug the antenna or battery only in their corresponding connectors. [LISTA] Do not use any type of paint on the device, it could affect the operation of closing mechanisms. [LISTA] For cleaning, use a damp cloth, no aggressive chemical products. 10 Disposal and recycling [LISTA] When Smart Parking reaches the end of its useful life you can conatct Libelium Sales department in order to ask for replacement. [LISTA] In case of not desiring to be used anymore it must be taken to a recycling point for electronic equipment. [LISTA] The equipment should be disposed of separately from solid urban waste, please dispose of correctly. [LISTA] Your distributor will advise you on the most appropriate and environmentallyfriendly way of disposing of the product and its packing.  11 Safety Guides 11.1 Smart Parking Chemical Fixing Cartridge            12 Documentation changelog From v8.0 to v8.1: [LISTA] Modified radar threshold range and default value [LISTA] Deleted radar recalibration column from Info frame example [LISTA] Added information about v1.2.x firmware versions From v7.9 to v8.0: [LISTA] Added information about the new Libelium LoRaWAN Base Station From v7.9 to v8.0: [LISTA] Added information about the new Libelium Cloud [LISTA] Deleted references to the discontinued Customer Server [LISTA] Deleted info about frames format [LISTA] Added notes about the End of Life of TTN and TTI network servers, and Libelium\u2019s end of support for them From v7.8 to v7.9: [LISTA] Max operation temperature returned to +65 \u00baC, since malfunctions may appear above this temperature From v7.7 to v7.8: [LISTA] Added information about v1.0.7 and v1.1.2 firmware versions which increase the sleep time range down to 10 seconds From v7.6 to v7.7: [LISTA] Added information about v1.0.x and v1.1.x firmware versions From v7.5 to v7.6: [LISTA] Added information about the IP68 certification (protection against dust and water ingress) [LISTA] Added information about the IK10 certification (protection against impacts) [LISTA] Max operation temperature increased to +85 \u00baC (nocontinuously) From v7.4 to v7.5: [LISTA] Deprecated the \u201cKeepalive nightmode\u201d setting in all configuration forms: Smart Parking Cloud Service, Customer Server and Smart Devices App [LISTA] Added new section to describe the Smart Parking Node\u2019s label with device\u2019s specifications [LISTA] Updated all released firmware versions From v7.3 to v7.4: [LISTA] Added information to enable the integration of the following 3 LoRaWAN Network Servers into the \u201cSmart Parking Cloud Service\u201d scenario: The Things Network, The Things Industries and MultiTech basestation\u2019s Embedded Network Server From v7.2 to v7.3: [LISTA] Added information to enable the integration of the following 3 LoRaWAN Network Servers into the \u201cCustomer Server\u201d scenario: The Things Network, The Things Industries and MultiTech basestation\u2019s Embedded Network Server [LISTA] Added diagram and dimensions of the vaulted enclosure [LISTA] Added info about the Customer Server: multiple instances, extract info and upgrade [LISTA] Errata correction From v7.1 to v7.2: [LISTA] Added Loriot license type recommendation [LISTA] Changed Loriot batch import format due to the new Loriot Network Server 5.0 From v7.0 to v7.1: [LISTA] Added safety guide for Smart Parking Chemical Fixing Cartridge [LISTA] Errata correction", "texto_traducido": "Contenidos 1 Introducci\u00f3n 3 2 Arquitectura de red 6 2.1 Nodo de estacionamiento inteligente. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6 2.2 Estaci\u00f3n base LoRaWAN. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6 2.3 Servidor de red LoRaWAN. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7 2.4 Nube de Libelio. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7 3 Nodo Smart Parking 8 3.1 Descripci\u00f3n del hardware. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 8 3.1.1 Versiones de nodo. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 9 3.1.2 Versiones de firmware. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 9 3.1.3 Regiones LoRaWAN. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 10 3.1.4 Protocolo y par\u00e1metros LoRaWAN. . . . . . . . . . . . . . . . . . . . . . . . . . . 10 3.1.5 Etiqueta de identificaci\u00f3n. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11 3.2 Consumo de energ\u00eda y tiempo . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11 3.2.1 Aparcamiento inteligente UE. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11 3.2.2 Estacionamiento inteligente EE. UU. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11 3.3 Cambios de usuario. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 12 3.4 Bot\u00f3n de reinicio. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 12 3.5 Configuraci\u00f3n del nodo. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13 3.5.1 Estado \u201cListo para instalar\u201d . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13 3.5.2 C\u00f3mo cerrar el nodo Smart Parking. . . . . . . . . . . . . . . . . . . . . . . . . . 13 3.5.3 Proceso de \u201carranque del im\u00e1n\u201d. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 14 3.6 C\u00f3mo funciona el nodo. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 15 3.6.1 Tipos de trama. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 15 3.6.2 Ejecuci\u00f3n del programa de nodo. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17 3.7 Par\u00e1metros del nodo. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17 3.7.1 Descripci\u00f3n de par\u00e1metros y rangos. . . . . . . . . . . . . . . . . . . . . . . . . . . 17 3.7.2 Comprensi\u00f3n de los marcos de informaci\u00f3n y Keepalive. . . . . . . . . . . . . . . . . . . . . . . 18 3.7.3 Entendiendo el modo nocturno. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19 3.7.4 Comprensi\u00f3n de la sincronizaci\u00f3n RTC. . . . . . . . . . . . . . . . . . . . . . . . . . 20 3.7.5 Comprensi\u00f3n del formato de tramas de enlace ascendente (ejemplo real) . . . . . . . . . . . . . . . . . . . 21 3.7.6 Valores predeterminados de f\u00e1brica. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21 3.7.7 Configurar nuevos valores de par\u00e1metros. . . . . . . . . . . . . . . . . . . . . . . . . . . . 22 4 Aplicaci\u00f3n para dispositivos inteligentes 23 4.1 Configuraci\u00f3n de los par\u00e1metros de Smart Parking v2. . . . . . . . . . . . . . . . . . . . . . . . . . . 23 4.1.1 C\u00f3mo conectar el nodo Smart Parking. . . . . . . . . . . . . . . . . . . . . . . . . . 23 4.1.2 Configuraci\u00f3n. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 23 4.1.3 Programador (cambiar par\u00e1metros del nodo) . . . . . . . . . . . . . . . . . . . . . . . . . 25 4.1.4 Actualizaci\u00f3n del firmware. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26 4.1.5 Restablecimiento de f\u00e1brica. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 27 5 Configuraci\u00f3n del servidor de red LoRaWAN 29 5.1 Loriot. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 29 5.1.1 Iniciar sesi\u00f3n. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 29 5.1.2 Crear una nueva aplicaci\u00f3n Loriot. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 29 5.1.3 Datos de salida: URL de Libelium Cloud. . . . . . . . . . . . . . . . . . . . . . . . . . . . 30 5.1.4 C\u00f3mo eliminar aplicaciones Loriot no utilizadas. . . . . . . . . . . . . . . . . . . . . . . . 32 5.1.5 C\u00f3mo crear un \u00fanico dispositivo manualmente. . . . . . . . . . . . . . . . . . . . . . . . . 32 5.1.6 Aprovisionamiento por lotes de nodos en Loriot. . . . . . . . . . . . . . . . . . . . . . . . . . . 33 5.2 Agilidad . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 34 5.2.1 C\u00f3mo crear un nuevo servidor de aplicaciones. . . . . . . . . . . . . . . . . . . . . . . . . 35 5.2.2 C\u00f3mo crear un nuevo perfil de enrutamiento AS. . . . . . . . . . . . . . . . . . . . . . . . . 36 5.2.3 C\u00f3mo crear nuevos dispositivos manualmente. . . . . . . . . . . . . . . . . . . . . . . . . . 38 5.2.4 Aprovisionamiento por lotes de nodos en Actility. . . . . . . . . . . . . . . . . . . . . . . . . . . 40 5.3 Estaci\u00f3n base Libelium. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 42 5.3.1 Servidores de red LoRa compatibles. . ... . ... . ... 50 7.3.1 Instalaci\u00f3n de nodo en superficie . ... . ... 60 8.2 FCC (Estados Unidos) . ... . ... 64 12 Registro de cambios de la documentaci\u00f3n 76 1 Introducci\u00f3n La soluci\u00f3n Smart Parking v2 desarrollada por Libelium permite a los ciudadanos detectar plazas de aparcamiento disponibles. Figura 1.0.1: Nodo Smart Parking desarrollado por Libelium El dispositivo Smart Parking aplica algoritmos inteligentes para detectar cambios en el estado de la plaza de aparcamiento. A continuaci\u00f3n, los datos se transmiten a trav\u00e9s de la infraestructura LoRaWAN a la LoR un servidor de red WAN. Finalmente, la informaci\u00f3n se entrega a un sistema final en la Nube. Figura 1.0.2: Arquitectura de estacionamiento inteligente Una de las siguientes posibilidades del sistema Cloud est\u00e1 disponible: [LISTA] Libelium Cloud (soluci\u00f3n SaaS): Nube proporcionada por Libelium que permite al usuario configurar de forma remota los par\u00e1metros del nodo (tiempo de suspensi\u00f3n, mantenimiento de actividad, modo nocturno, etc). Eso hace posible instalar directamente los nodos con la configuraci\u00f3n predeterminada de f\u00e1brica y luego actualizarlos desde el lado del servidor. Se admiten los servidores de red Loriot y Actility LoRaWAN. Adem\u00e1s, se proporcionan mapas de visualizaci\u00f3n y conectores en la nube. [LISTA] FIWARE (soluci\u00f3n local): las plataformas basadas en FIWARE son compatibles siempre que se utiliza el servidor de red ChirpStack LoRaWAN. Si el cliente ya proporciona la plataforma FIWARE, Libelium proporciona la decodificaci\u00f3n de cuadros y el tratamiento de datos. Por otro lado, se proporciona una instalaci\u00f3n FIWARE completa en el sistema del usuario cuando sea necesario. [LISTA] Plataforma de terceros del cliente (soluci\u00f3n local): cualquier nube o plataforma desarrollada por el usuario que pueda proporcionar una base de datos, visualizaci\u00f3n, etc. En este escenario, tambi\u00e9n se debe desarrollar la conexi\u00f3n al servidor de red LoRaWAN. La documentaci\u00f3n de decodificaci\u00f3n de fotogramas se proporciona al cliente cuando se elige esta opci\u00f3n. Caracter\u00edstica Libelium Cloud Cliente FIWARE Plataforma de terceros Alojamiento de servidor SaaS Onpremise Servidor de red local Loriot o Actility ChirpStack Cualquiera integrado por el Cliente Visualizaci\u00f3n S\u00ed S\u00ed Debe ser desarrollado por el Cliente Configuraci\u00f3n remota S\u00ed No Debe ser desarrollado por el Cliente El aprovisionamiento de los dispositivos es muy simple . Los nodos se entregan con configuraciones de programa predeterminadas e identificadores y claves \u00fanicos de LoRaWAN. Por lo tanto, es f\u00e1cil utilizar la configuraci\u00f3n predeterminada para registrar todos los nodos en el servidor de red LoRaWAN a la vez. El nodo Smart Parking proporciona un rendimiento de detecci\u00f3n sobresaliente gracias a su sensor de radar. La siguiente tabla muestra un an\u00e1lisis comparativo de las tecnolog\u00edas de sensores actuales en el mercado de Smart Parking: Configuraci\u00f3n de par\u00e1metros remotos de Libelium Cloud: Figura 1.0.3: Configuraci\u00f3n de par\u00e1metros remotos de Libelium Cloud 2 Arquitectura de red La arquitectura de red de Smart Parking se basa en los siguientes elementos: [LISTA] Nodo Smart Parking [LISTA] Estaci\u00f3n base LoRaWAN [LISTA] Servidor de red LoRaWAN [LISTA] Libelium Cloud Figura 2.0.1: Arquitectura de la soluci\u00f3n Smart Parking de Libelium 2.1 Nodo Smart Parking El nodo Smart Parking es el dispositivo instalado en cada plaza de aparcamiento . Cuando el dispositivo detecta un cambio de pa Al registrar el estado del slot (libre/ocupado), env\u00eda una trama a la estaci\u00f3n base LoRaWAN. Figura 2.1.1: Nodo de estacionamiento inteligente 2.2 Estaci\u00f3n base LoRaWAN La estaci\u00f3n base LoRaWAN (tambi\u00e9n conocida como puerta de enlace) debe instalarse en el \u00e1rea circundante junto a los nodos de estacionamiento. Recibe datos y los reenv\u00eda al servidor de red LoRaWAN. Libelium distribuye estaciones base para redes LoRaWAN. Todos ellos cuentan con conexi\u00f3n LoRaWAN; algunos tambi\u00e9n cuentan con conectividad Ethernet, WiFi o 4G. Algunas estaciones base est\u00e1n preparadas para funcionar en exteriores (grado IP67). Algunos de ellos vienen preconfigurados para ciertos servidores de red LoRaWAN (consulte la siguiente secci\u00f3n). Adem\u00e1s, algunos de ellos integran un servidor de red LoRaWAN integrado. Figura 2.2.1: Estaci\u00f3n base LoRaWAN 2.3 Servidor de red LoRaWAN El registro de los nodos debe realizarse en el servidor de red para poder recibir datos LoRaWAN de todos los nodos de la red. Cada nodo debe estar registrado con un identificador y algunas claves de cifrado para que el servidor de red pueda recibir y descifrar los paquetes correctamente. El prop\u00f3sito del servidor de red LoRaWAN es traducir datos de la red inal\u00e1mbrica LoRaWAN a una red IP. Por lo tanto, cuando se reciben paquetes de nodos de Smart Parking, se realiza una devoluci\u00f3n de llamada para enviar datos a Libelium Cloud. 2.4 Libelium Cloud El servidor de red LoRaWAN se conecta al servidor final: Libelium Cloud. Libelium Cloud permite recibir, decodificar, almacenar y explotar datos. El usuario tambi\u00e9n puede redirigir datos a una nube de IoT de terceros (Amazon Web Services, Microsoft Azure, etc.). Esta retransmisi\u00f3n se realiza gracias a los conectores de nube que se ejecutan en Libelium Cloud. Adem\u00e1s, Libelium Cloud permite al usuario actualizar la configuraci\u00f3n de cada nodo de aparcamiento (tiempo de reposo, tiempo de actividad, modo nocturno, etc.). La actualizaci\u00f3n se realiza de forma remota a trav\u00e9s de paquetes de radio de enlace descendente LoRaWAN. Figura 2.4.1: D\u00f3nde se encuentra Libelium Cloud en la soluci\u00f3n completa 3 Nodo Smart Parking 3.1 Descripci\u00f3n del hardware El nodo Smart Parking se basa en 2 piezas diferentes: la base y el recinto externo. La base del nodo Smart Parking incluye la PCB, la bater\u00eda, la antena y la pieza de carcasa interna. La base se atornilla a la pieza exterior del armario. La siguiente tabla muestra las caracter\u00edsticas b\u00e1sicas del nodo Smart Parking. Dimensiones de la carcasa 200 x 200 x 37,25 mm Materiales de la carcasa Poliamida, polipropileno y fibra de vidrio Peso 0,813 kg (incluidos los accesorios de instalaci\u00f3n) 0,540 kg (solo el nodo Smart Parking) Fuente de alimentaci\u00f3n Bater\u00edas integradas de cloruro de tionilo de litio (LiSOCl2); de 410 a\u00f1os* Tiempo de suspensi\u00f3n configurable Min: 10 s / max: 10 min Protocolo de radio M\u00f3dulo LoRaWAN Detecci\u00f3n dual Radar (principal) y magn\u00e9tico (de respaldo) Aprovisionamiento Listo para instalar (los ID y la clave LoRaWAN OTAA de f\u00e1brica est\u00e1n preconfigurados para cada nodo) Configuraci\u00f3n de nodo A trav\u00e9s de la configuraci\u00f3n Libelium Cloud LoRaWAN A trav\u00e9s de \u201cSmart Devices App\u201d (aplicaci\u00f3n de escritorio Java) Temperatura de funcionamiento 20 a +65 \u00b0C Certificaciones de mercado CE (Europa) FCC (EE. UU.) UKCA Certificaci\u00f3n de protecci\u00f3n de ingreso IP68 (clasificaci\u00f3n m\u00e1xima contra el ingreso de polvo y agua) Protecci\u00f3n contra impactos Certificaci\u00f3n IK10 (clasificaci\u00f3n m\u00e1xima contra impactos) (*) En circunstancias normales y dependiendo de la configuraci\u00f3n (**) No se recomienda el funcionamiento continuo en temperaturas extremas (altas o bajas) durante largos per\u00edodos de tiempo; por ejemplo, esto puede provocar una reducci\u00f3n de la bater\u00eda. capacidad, menor rendimiento del radar o reinicios aleatorios Figura 3.1.1: Dimensiones del gabinete abovedado El sensor de radar realiza un proceso de recalibraci\u00f3n peri\u00f3dicamente para brindar la medici\u00f3n m\u00e1s precisa. Es una funci\u00f3n autom\u00e1tica, por lo que no se requiere ninguna acci\u00f3n por parte del usuario. Adem\u00e1s, esta recalibraci\u00f3n es interna, por lo que siempre se realiza correctamente, independientemente de si hay un veh\u00edculo encima del nodo o no. 3.1.1 Versiones de nodo Libelium proporciona las siguientes versiones de Smart Parking: Versi\u00f3n de referencia Frecuencia de funcionamiento SPEU Smart Parking EU 863,0 a 870,0 MHz (LoRaWAN EU863870) SPUS Smart Parking US 902,0 a 928,0 MHz (LoRaWAN US902928) SPAPLAAU Smart Parking APAC/LATAM/AU /AU915 915,2 a 927,8 MHz (LoRaWAN AU915928) SPIN Smart Parking IN 865,0 a 867,0 MHz (LoRaWAN IN865867) SPAPLAAS Smart Parking APAC/LATAM/AU/AS923 923 MHz (LoRaWAN AS923) 3.1.2 Versiones de firmware Versiones de firmware de los nodos Smart Parking: Versi\u00f3n de firmware Descripci\u00f3n v1.0.x Primeras versiones del nodo Smart Parking (obsoleto) v1.1.1 Primera versi\u00f3n estable en la generaci\u00f3n v1.1.x v1.1.2 Tiempo m\u00ednimo de suspensi\u00f3n de 20 a 10 segundos v1.1.3 Se corrigieron problemas del fabricante de LoRaWAN en EE. UU. v1. 1.4 Medici\u00f3n de sensores mejorada con altas temperaturas Versi\u00f3n de firmware Descripci\u00f3n v1.2.0 Mejora del consumo de energ\u00eda en comportamientos de mala cobertura y estados dudosos. Actualizaci\u00f3n en el encabezado del marco: bit de recalibraci\u00f3n para detecci\u00f3n dudosa 3.1.3 Regiones LoRaWAN El nodo Smart Parking admite las siguientes regiones LoRaWAN: Regi\u00f3n LoRaWAN Compatible con la banda ISM de 863870 MHz de la UE (Europa) Smart Parking UE EE. UU. Banda ISM de 902928 MHz (Estados Unidos) Inteligente Parking US AU 915928 MHz Banda ISM (Australia) Smart Parking APAC / LATAM / AU / AU915 IN 865867 MHz Banda ISM (India) Smart Parkin g IN AS Banda ISM de 923 MHz (Asia y regi\u00f3n ASEAN) Smart Parking APAC / LATAM / AU / AS923 CN Banda ISM de 779787 MHz (China) No disponible CN Banda ISM de 470510 MHz (China) No disponible KR Banda ISM de 920923 MHz (Corea del Sur) ) No disponible Banda ISM de 433 MHz (mundial) No disponible Si est\u00e1 interesado en obtener m\u00e1s informaci\u00f3n sobre las regulaciones nacionales de LoRaWAN, consulte el documento de par\u00e1metros regionales de LoRa Alliance. 3.1.4 Protocolo y par\u00e1metros LoRaWAN LoRaWAN es un protocolo de red de \u00e1rea amplia de baja potencia (LPWAN). Es una t\u00e9cnica de modulaci\u00f3n de espectro ensanchado a velocidades de datos extremadamente bajas que permite enviar datos a grandes distancias. Los par\u00e1metros de LoRaWAN m\u00e1s importantes son: [LISTA] LoRaWAN EUI: Identificador \u00fanico de solo lectura, de 8 bytes, que define cada m\u00f3dulo LoRaWAN del mercado. [LISTA] EUI del dispositivo: lectura/escritura, identificador de 8 bytes configurado en el m\u00f3dulo LoRaWAN para usarse como identificador operativo. De forma predeterminada, el \u201cLoRaWAN EUI\u201d del m\u00f3dulo est\u00e1 configurado de f\u00e1brica como \u201cDevice EUI\u201d en el nodo Smart Parking. [LISTA] Modo de uni\u00f3n: ABP u OTAA. Define c\u00f3mo el m\u00f3dulo se une a la red. Se necesitan claves diferentes para cada m\u00e9todo. [LISTA] Direcci\u00f3n del dispositivo: Necesaria para ABP. La direcci\u00f3n de 4 bytes del m\u00f3dulo LoRaWAN. Debe ser \u00fanico en su propia subred. [LISTA] Clave de sesi\u00f3n de red: necesaria para ABP. La clave AES de 16 bytes. Se utiliza para generar la verificaci\u00f3n de integridad del mensaje. [LISTA] Clave de sesi\u00f3n de solicitud: necesaria para ABP. La clave AES de 16 bytes. Se utiliza para cifrar datos. [LISTA] Aplicaci\u00f3n EUI: Necesaria para OTAA. El identificador de aplicaci\u00f3n de 8 bytes. Necesario para abrir una sesi\u00f3n OTAA e intercambiar claves de cifrado. [LISTA] Clave de aplicaci\u00f3n: necesaria para OTAA. La clave de 16 bytes. Necesario para abrir una sesi\u00f3n OTAA e intercambiar claves de cifrado. [LISTA] Datarate: Define la velocidad de transmisi\u00f3n (bits por segundo). Cada configuraci\u00f3n de velocidad de datos combina diferentes factores de dispersi\u00f3n (SF) y ancho de banda (BW). De forma predeterminada, todas las regiones LoRaWAN utilizan la misma velocidad de datos (DR 0). Sin embargo, dependiendo de la regi\u00f3n, eso significa diferentes SF y BW: \u2013 Versi\u00f3n LoRaWAN EU863870: SF12 / 125 kHz \u2013 Versi\u00f3n LoRaWAN IN865867: SF12 / 125 kHz \u2013 Versi\u00f3n LoRaWAN AS923: SF12 / 125 kHz \u2013 Versi\u00f3n LoRaWAN US902928: SF10 / 125 kHz \u2013 Versi\u00f3n LoRaWAN AU915928: SF10 / 125 kHz [LISTA] ADR: Configuraci\u00f3n de velocidad de datos adaptable que se puede habilitar o deshabilitar. Si ADR est\u00e1 habilitado, el servidor optimizar\u00e1 la velocidad de datos en funci\u00f3n de la informaci\u00f3n recopilada de la red: el RSSI/SNR de los \u00faltimos paquetes recibidos. Si est\u00e1 interesado en obtener m\u00e1s informaci\u00f3n sobre LoRaWAN espec\u00edfico Para m\u00e1s informaci\u00f3n, consulte el documento de especificaciones de LoRa Alliance. 3.1.5 Etiqueta de identificaci\u00f3n Hay una pegatina en la parte inferior de la base del nodo Smart Parking. En esta pegatina se pueden ver varias especificaciones del dispositivo. Por ejemplo el \u201cModelo\u201d que hace referencia a la regi\u00f3n del dispositivo. Adem\u00e1s, se muestra la \u201cLoRaWAN EUI\u201d \u00fanica para que se pueda distinguir cada nodo. Figura 3.1.2: Etiqueta del nodo Smart Parking 3.2 Consumo de energ\u00eda y tiempo El firmware del nodo Smart Parking ejecuta diferentes pasos desde que se inicia el nodo. Primero, la configuraci\u00f3n del nodo y luego un bucle infinito donde cada ciclo se basa en medir, enviar si es necesario y dormir. Las siguientes tablas muestran el consumo de energ\u00eda y tiempo de cada paso modelado como un pulso de una duraci\u00f3n de tiempo espec\u00edfica y el consumo de energ\u00eda promedio. 3.2.1 Smart Parking EU Consumo de energ\u00eda Consumo de tiempo Configuraci\u00f3n del nodo 22,9 mA 59 s Ciclo de medici\u00f3n 26 mA 340 ms Ciclo de medici\u00f3n y env\u00edo 17 mA 6 s Ciclo de suspensi\u00f3n 5,5 uA Depende de la configuraci\u00f3n del tiempo de suspensi\u00f3n (*) LoRaWAN EU est\u00e1 configurado en el SF12 predeterminado configuraci\u00f3n (peor de los casos). El proceso de env\u00edo puede tener una potencia menor si el nodo est\u00e1 cerca de la estaci\u00f3n base. 3.2.2 Estacionamiento inteligente EE. UU. Consumo de energ\u00eda Consumo de tiempo Configuraci\u00f3n del nodo 21,8 mA 53 s Ciclo de medici\u00f3n 26 mA 340 ms Ciclo de medici\u00f3n y env\u00edo 20 mA 3,6 s Ciclo de suspensi\u00f3n 5,5 uA Depende de la configuraci\u00f3n del tiempo de suspensi\u00f3n (*) LoRaWAN US est\u00e1 configurado en el SF10 predeterminado configuraci\u00f3n (peor de los casos). El proceso de env\u00edo puede tener una potencia menor si el nodo est\u00e1 cerca de la estaci\u00f3n base. 3.3 Interruptores de usuario El nodo Smart Parking tiene 2 interruptores para administrar el modo de trabajo: [LISTA] Interruptor de encendido/apagado: determina si el nodo est\u00e1 encendido o apagado [LISTA] Interruptor de aplicaci\u00f3n/arranque: cuando el nodo est\u00e1 encendido, este interruptor determina el Estado de rendimiento del dispositivo \u2013 La posici\u00f3n de la aplicaci\u00f3n debe usarse para un modo de operaci\u00f3n normal, de modo que el dispositivo ejecute el firmware dentro de ella \u2013 La posici\u00f3n de inicio debe usarse solo con fines de configuraci\u00f3n Figura 3.3.1: Nodo de estacionamiento inteligente \u201clos usuarios cambian\u201d Cuando el nodo est\u00e1 encendido (interruptor On), puede cambiar de Aplicaci\u00f3n a Arranque o viceversa cambiando el estado del interruptor Aplicaci\u00f3n/Arranque. Sin embargo, debe presionar el bot\u00f3n de reinicio para aplicar el cambio de modo de operaci\u00f3n. Otra posibilidad para cambiar con \u00e9xito el modo de funcionamiento paso a paso ser\u00eda: apagar el dispositivo (interruptor de apagado), cambiar el interruptor de aplicaci\u00f3n/arranque, presionar el bot\u00f3n de reinicio y luego encender el dispositivo. Nunca deje el dispositivo configurado en Encendido y Arrancado por m\u00e1s tiempo del necesario. El gestor de arranque no proporciona ning\u00fan modo de suspensi\u00f3n y desperdiciar\u00e1 la bater\u00eda. y del dispositivo. Entonces, cuando termine de reconfigurar el dispositivo, configure el nodo en estado apagado. 3.4 Bot\u00f3n de reinicio El bot\u00f3n de reinicio se puede utilizar para reiniciar el nodo en el modo de operaci\u00f3n correspondiente (Aplicaci\u00f3n o Arranque). Si el nodo est\u00e1 configurado en \"Aplicaci\u00f3n\" (modo de operaci\u00f3n normal), al presionar el bot\u00f3n de reinicio se reiniciar\u00e1 la ejecuci\u00f3n del programa. Por otro lado, si el nodo est\u00e1 configurado para Arrancar (modo de configuraci\u00f3n), al presionar el bot\u00f3n de reinicio se reiniciar\u00e1 el cargador de arranque de la MCU para su reconfiguraci\u00f3n o actualizaci\u00f3n de firmware. Figura 3.4.1: Bot\u00f3n de reinicio 3.5 Configuraci\u00f3n del nodo 3.5.1 Estado \u201cListo para instalar\u201d Libelium proporciona los nodos \u201clistos para instalar\u201d para que el usuario solo necesite instalar los nodos y seguir el proceso de \u201cinicio del im\u00e1n\u201d. El nodo Smart Parking tiene un proceso de encendido para poner el dispositivo en un estado \"listo para instalar\": [LISTA] Paso 1: Los interruptores est\u00e1n configurados en \"App\" y \"Off\" (presione el bot\u00f3n de reinicio para asegurarse de descargar los condensadores ) [LISTA] Paso 2: Enciende el dispositivo deslizando el interruptor de \u201cApagado\u201d a \u201cEncendido\u201d [LISTA] Paso 3: Ambos LED (rojo y verde) parpadean r\u00e1pidamente 5 veces [LISTA] Paso 4: LED rojo parpadea una vez durante 1 segundo para indicar que el dispositivo ingresa al modo de suspensi\u00f3n por primera vez. Ahora el nodo est\u00e1 en estado \"listo para instalar\". El cliente debe instalar el nodo en el escenario real y realizar el proceso de \u201cinicio del im\u00e1n\u201d. Figura 3.5.1: Indicaci\u00f3n LED \u201cListo para instalar\u201d Puedes ver c\u00f3mo se realizan los pasos anteriores en este video: Proceso listo para instalar 3.5.2 C\u00f3mo cerrar el nodo Smart Parking Luego de seguir los pasos anteriores, se puede cerrar el dispositivo. Para cerrar correctamente el nodo y asegurar un correcto sellado se deben seguir estrictamente los siguientes pasos. [LISTA] Paso 1: Aseg\u00farese de que los tornillos tengan los orings para evitar el ingreso de agua. Figura 3.5.2: Tornillo con junta t\u00f3rica [LISTA] Paso 2: Aseg\u00farese de que la superficie superior de la junta est\u00e9 limpia y no contenga objetos extra\u00f1os. [LISTA] Paso 3: Coloque la carcasa interior dentro de la carcasa exterior y aseg\u00farese de que las 2 marcas de posici\u00f3n coincidan. Figura 3.5.3: Marcas de posici\u00f3n de la carcasa [LISTA] Paso 4: Inserte los tornillos y apri\u00e9telos hasta la mitad. Figura 3.5.4: Tornillos en su posici\u00f3n [LISTA] Paso 5: Finalmente, apriete firmemente los 4 tornillos. No use la presi\u00f3n m\u00e1xima (no llegue hasta el fondo con los tornillos), porque los orings podr\u00edan salir expulsados \u200b\u200bde los tornillos, y entonces la caracter\u00edstica de impermeabilidad NO ser\u00eda v\u00e1lida. Adem\u00e1s, no atornille demasiado fuerte y siga atornillando, porque los tornillos podr\u00edan tallar los encajes hembra, ampliando la Su di\u00e1metro interior; esto tambi\u00e9n cancelar\u00eda la calidad impermeable. Libelium fabrica y proporciona todos los nodos configurados despu\u00e9s de seguir todos los pasos explicados, de modo que el nodo est\u00e9 \"listo para instalar\". De forma predeterminada, todos los nodos est\u00e1n configurados con su EUI LoRaWAN \u00fanica y claves privadas aleatorias. Por otro lado, si se desean par\u00e1metros LoRaWAN diferentes, se debe utilizar \u201cSmartDevicesApp\u201d para cambiar la configuraci\u00f3n y repetir los pasos explicados anteriormente. 3.5.3 Proceso de \u201cinicio del im\u00e1n\u201d Una vez que el nodo se ha configurado en estado \u201clisto para instalar\u201d y se ha cerrado y colocado en el espacio de estacionamiento, se debe realizar el \u201cinicio del im\u00e1n\u201d. Este proceso consiste en resetear el dispositivo utilizando el im\u00e1n 3 veces consecutivas. Cada reinicio del im\u00e1n debe estar separado por al menos un segundo per\u00edodo. La mejor forma de proceder con el im\u00e1n es recorrer el recinto de izquierda a derecha con un movimiento de un solo movimiento. Luego espera al menos un segundo (aunque puedes esperar m\u00e1s) y contin\u00faa nuevamente hasta completar 3 reinicios del im\u00e1n. Figura 3.5.5: Reinicio del im\u00e1n En el siguiente videoclip se puede ver c\u00f3mo se realiza el \u201cinicio del im\u00e1n\u201d: Inicio del im\u00e1n Luego de finalizar el \u201cinicio del im\u00e1n\u201d, el nodo comienza a funcionar normalmente por el resto del tiempo. No se necesitan m\u00e1s \u201crestablecimientos magn\u00e9ticos\u201d tres veces para restablecer el dispositivo correctamente. Entonces, si se aplica un reinicio del cuarto im\u00e1n o un reinicio del software, el dispositivo se reiniciar\u00e1 y continuar\u00e1 funcionando normalmente nuevamente. El \u201carranque magn\u00e9tico\u201d solo es obligatorio cuando el nodo se alimenta desde un estado apagado. En otras palabras, cuando el dispositivo est\u00e1 configurado en estado \"listo para instalar\". 3.6 C\u00f3mo funciona el nodo 3.6.1 Tipos de tramas La arquitectura Smart Parking gestiona diferentes tramas de enlace ascendente y descendente. La siguiente tabla muestra los cuadros de enlace ascendente: Tipo de cuadro Descripci\u00f3n Cuadro inicial 1 Primer cuadro enviado por el nodo al iniciar (con configuraci\u00f3n de par\u00e1metros) Cuadro inicial 2 Segundo cuadro enviado por el nodo al iniciar (con configuraci\u00f3n de par\u00e1metros) Cuadro de informaci\u00f3n Se utiliza para informar a un Estacionamiento Cambio de estado Marco Keepalive Se utiliza para informar que el dispositivo sigue funcionando desde el \u00faltimo estado informado Enlace ascendente de configuraci\u00f3n Se utiliza para confirmar que se aplic\u00f3 o no un \"enlace descendente de configuraci\u00f3n\" Solicitud de actualizaci\u00f3n de RTC Se utiliza para solicitar una sincronizaci\u00f3n de RTC una vez al d\u00eda La siguiente tabla muestra los marcos de enlace descendente: Tipo de trama Descripci\u00f3n Configuraci\u00f3n enlace descendente Se utiliza para actualizar los par\u00e1metros del nodo. Despu\u00e9s de que el cliente establece una nueva configuraci\u00f3n de nodo en el formulario de configuraci\u00f3n remota, se pone en cola una nueva trama de \"enlace descendente de configuraci\u00f3n\" en la ventana del servidor de red LoRaWAN. cola de enlace. Marco de sincronizaci\u00f3n RTC Se utiliza para sincronizar el RTC del nodo con la marca de tiempo del servidor. Es la respuesta obligatoria a las tramas de enlace ascendente \u201cInicio de cuadro 1\u201d y \u201cSolicitud de actualizaci\u00f3n RTC\u201d. Las tramas de enlace ascendente tienen una longitud de 11 bytes para cumplir siempre con el peor de los casos de velocidad de datos de LoRaWAN. Su estructura consta de 2 partes: encabezado y carga \u00fatil. El formato del \"encabezado\" es siempre el mismo para todos los tipos de tramas de enlace ascendente. Por otro lado, el formato de \u201ccarga \u00fatil\u201d puede ser diferente para cada tipo de trama. Respecto a las tramas de enlace descendente, tienen longitud variable y su formato es privado del cliente. El \u201ccuadro de sincronizaci\u00f3n RTC\u201d es la respuesta obligatoria para los cuadros \u201cInicio de cuadro 1\u201d y \u201cSolicitud de actualizaci\u00f3n RTC\u201d. El \"marco de sincronizaci\u00f3n RTC\" proporciona la hora del servidor a los nodos para mantener el RTC actualizado. Adem\u00e1s, el \u201cenlace descendente de configuraci\u00f3n\u201d es una trama as\u00edncrona enviada por el servidor cuando el formulario de configuraci\u00f3n remota es administrado por el cliente. Debes tener en cuenta que cuando se solicita un paquete de enlace descendente suele haber algunos problemas relacionados con la latencia de la red LoRaWAN. Esto implica que el primer intento de solicitud suele fallar. En ese caso, se env\u00eda un segundo intento para recuperar el paquete de enlace descendente perdido. Por este motivo, es posible que vea que se env\u00edan secuencialmente un par de tramas de \u201cMarco de inicio 1\u201d o \u201cSolicitud de actualizaci\u00f3n RTC\u201d durante la ejecuci\u00f3n del programa. Libelium Cloud tiene el c\u00f3digo necesario para analizar datos dentro de marcos en una estructura m\u00e1s completa. Los conectores de nube tambi\u00e9n proporcionan las herramientas necesarias para transmitir los datos analizados a una nube de IoT de terceros. 3.6.2 Ejecuci\u00f3n del programa del nodo Figura 3.6.1: Diagrama de flujo del programa del nodo Smart Parking 3.7 Par\u00e1metros del nodo 3.7.1 Descripci\u00f3n y rangos de los par\u00e1metros El nodo Smart Parking tiene diferentes par\u00e1metros que cambian el tiempo y el rendimiento de detecci\u00f3n del nodo. La siguiente tabla muestra los par\u00e1metros del nodo: Par\u00e1metro Rango Descripci\u00f3n Tiempo de reposo 110 min o 1059 s Minutos o segundos transcurridos entre cada ciclo de medici\u00f3n Tiempo de mantenimiento 0,5, 1, 2,\u2026, 23 horas Horas transcurridas desde el \u00faltimo mensaje de enlace ascendente que activa una nueva trama de mantenimiento Modo nocturno 0 o 1 Modo nocturno deshabilitado/habilitado Inicio del modo nocturno 0, 1,\u2026, 23 horas El modo nocturno comienza cuando RTC alcanza este campo de par\u00e1metro Duraci\u00f3n del modo nocturno 1, 2,\u2026, 15 horas El per\u00edodo del modo nocturno es igual a este campo Modo nocturno suspendido 1, 2,\u2026 , 10 min Tiempo de sue\u00f1o aplicado durante el modo nocturno Inicio del alcance del radar 20 a 50 cm Distancia inicial de medici\u00f3n (los objetos por debajo de este valor no se detectan) Longitud del alcance del radar 50 a 100 cm Rango de medici\u00f3n a agregar d al valor de \u201cinicio de rango\u201d Umbral de radar 10 a 50 Umbral utilizado en el algoritmo de detecci\u00f3n, por lo que un umbral m\u00e1s alto implica una detecci\u00f3n menos sensible Modo de uni\u00f3n LoRaWAN 0 (ABP) o 1 (OTAA) Modo de uni\u00f3n usado por el m\u00f3dulo de radio LoRaWAN Identificador LoRaWAN DevEUI de 8 bytes Define el EUI del dispositivo utilizado por la radio LoRaWAN LoRaWAN DevAddr Identificador de 4 bytes Define la direcci\u00f3n del dispositivo utilizada por la radio LoRaWAN en modo ABP LoRaWAN NwkSKey Clave de 16 bytes Define la clave de sesi\u00f3n de red LoRaWAN utilizada por la radio LoRaWAN en modo ABP LoRaWAN AppSKey Clave de 16 bytes Define la aplicaci\u00f3n LoRaWAN Clave de sesi\u00f3n utilizada por la radio LoRaWAN en modo ABP LoRaWAN AppKey Clave de 16 bytes Define la clave de aplicaci\u00f3n LoRaWAN utilizada por la radio LoRaWAN en modo OTAA Identificador de 8 bytes LoRaWAN AppEUI Define la EUI de la aplicaci\u00f3n LoRaWAN utilizada por la radio LoRaWAN en modo OTAA Puerto LoRaWAN 1 a 223 Define el puerto utilizado para env\u00edos de enlace ascendente LoRaWAN ADR 0 (apagado) o 1 (encendido) Define si la velocidad de datos adaptable est\u00e1 habilitada o deshabilitada. Retraso LoRaWAN RX1 0 a 65536 Define el retraso despu\u00e9s de la primera ventana LoRaWAN rx Subbanda LoRaWAN Mapa de bits de 8 bits Define la subbanda utilizada por Radio LoRaWAN (solo se aplica a las versiones de EE. UU. y AU) Los identificadores y claves de LoRaWAN deben registrarse en el servidor de la red LoRaWAN antes de iniciar el nodo para poder recibir datos. Para modo OTAA: DevEUI, AppEUI y Appkey. Para modo ABP: DevEUI, DevAddr, NwkSKey y AppSKey. 3.7.2 Comprensi\u00f3n de los marcos de informaci\u00f3n y Keepalive En el modo de trabajo normal (modo diurno), se utilizan los par\u00e1metros \"Sleep\" y \"Keepalive\". Entonces, el nodo normalmente duerme durante un tiempo de \"suspensi\u00f3n\" espec\u00edfico y luego se despierta, mide y aplica el algoritmo de detecci\u00f3n para detectar cambios en el espacio de estacionamiento. Si se detecta un cambio de \"libre\" a \"ocupado\" o viceversa, se env\u00eda una trama \"Informaci\u00f3n\". Si no se produjo ning\u00fan cambio durante el \u00faltimo tiempo de \"Keepalive\", se env\u00eda una trama Keepalive. Adem\u00e1s, si se detecta un error en el sensor, se fuerza el env\u00edo de una trama Keepalive para informar sobre este problema. Par\u00e1metros de ejemplo utilizados: [LISTA] Dormir: 7 minutos [LISTA] Keepalive: 1 hora Figura 3.7.1: Marcos de informaci\u00f3n y Keepalive de ejemplo 3.7.3 Entendiendo el modo nocturno Como se muestra en la tabla de par\u00e1metros, hay algunos par\u00e1metros que permiten al usuario configurar El nodo puede utilizar 2 modos de trabajo dependiendo de la configuraci\u00f3n horaria: modo diurno y modo nocturno. El modo nocturno es un modo de trabajo secundario y opcional que permite al usuario configurar diferentes par\u00e1metros de base horaria para reducir el impacto de la bater\u00eda. Entonces, fue desarrollado para usarlo cuando Se espera que el espacio de estacionamiento tenga menos cambios (es decir, de noche). Por lo tanto, se utiliza una configuraci\u00f3n de modo nocturno diferente \"Suspender\". No es obligatorio usar el modo nocturno durante la noche. Se piensa que este modo se usa cuando se espera menos movimiento de veh\u00edculos en los espacios de estacionamiento. Lo que podr\u00eda ser durante el d\u00eda. Ejemplo: [LISTA] Modo diurno: \u2013 Sue\u00f1o: 1 minuto [LISTA] Modo nocturno: \u2013 Hora de inicio del modo nocturno: 21 horas (9 p. m.) \u2013 Duraci\u00f3n del modo nocturno: 10 horas (el modo nocturno va de las 9 p. m. a las 7 a. m.) \u2013 Tiempo de suspensi\u00f3n del modo nocturno: 10 minutos En el ejemplo, de las 9 p. m. a las 7 a. m., el nodo desperdiciar\u00e1 menos bater\u00eda porque las mediciones se realizan cada 10 minutos en lugar de cada minuto. Los eventos Keepalive no se muestran, pero se activar\u00eda un evento Keepalive si no se produce ning\u00fan cambio en el espacio de estacionamiento. Figura 3.7.2: Ejemplo de modo d\u00eda y noche La conclusi\u00f3n es que el modo Noche es interesante para los clientes que saben con certeza que se espera que el espacio de estacionamiento tenga menos cambios durante grandes per\u00edodos de tiempo todos los d\u00edas. Desde octubre de 2019, la configuraci\u00f3n \"keepalive nightmode\" qued\u00f3 obsoleta para simplificar la gesti\u00f3n de par\u00e1metros. Desde entonces, hay una \u00fanica configuraci\u00f3n keepalive, tanto para el \"modo normal\" como para el \"modo noche\". 3.7.4 Entendiendo la sincronizaci\u00f3n de RTC Hay tipos de tramas espec\u00edficas que permiten al nodo sincronizar el RTC con la marca de tiempo del servidor. La \"Trama de inicio 1\" espera una respuesta del servidor con la marca de tiempo (horas y minutos). Esta trama se env\u00eda despu\u00e9s de iniciar el nodo o un reinicio de software. Adem\u00e1s, el firmware del nodo proporciona un mecanismo por el cual se env\u00eda una trama de \"solicitud de actualizaci\u00f3n de RTC\" cada 24 horas desde que se inici\u00f3 o restableci\u00f3 el nodo. Esta trama espera una trama de enlace descendente que traiga la marca de tiempo actual del servidor (hora y minutos). Figura 3.7.3: Ejemplo de sincronizaci\u00f3n RTC La sincronizaci\u00f3n RTC es importante para Nightmode solo donde es obligatorio operar con una marca de tiempo correcta para ingresar y salir del modo nocturno al modo diurno y viceversa. 3.7.5 Entendiendo el formato de tramas de enlace ascendente (ejemplo real) La siguiente tabla muestra todas las tramas enviadas por un solo nodo desde que se inici\u00f3. Las diferentes columnas muestran los datos analizados de los \"datos de enlace ascendente\" recibidos. Ejemplo: [LISTA] Daymode: \u2013 Sleep: 1 minuto \u2013 Keepalive: 2 horas [LISTA] Nightmode: \u2013 Hora de inicio de Nightmode: 22 horas (10 PM) \u2013 Duraci\u00f3n de Nightmode: 8 horas (Nightmode va de 10 PM a 6 AM) \u2013 Tiempo de suspensi\u00f3n de Nightmode: 5 minutos Es posible distinguir las tramas de inicio al comienzo de la ejecuci\u00f3n. Luego, el nodo informa con un nuevo Keepalive cada 2 horas. y el cambio de estado de la plaza de aparcamiento implica un nuevo cuadro de informaci\u00f3n. Y despu\u00e9s de 24 horas de funcionamiento, podr\u00e1 ver la solicitud de RTC realizada por el nodo. Marca de tiempo F. Tipo Estacionamiento Bater\u00eda Sec. 15/04/19 15:59 4 (Inicio 1) No disponible 0 0 15/04/19 15:59 5 (Inicio 2) No disponible 0 1 15/04/19 15:59 1 (Keepalive) Gratis 0 2 15/04/19 17:29 1 (Keepalive) Gratis 0 3 15/04/19 19:29 1 (Keepalive) Gratis 0 4 15/04/19 21:29 1 (Keepalive) Gratis 0 5 16/04/19 23:29 1 (Keepalive) Gratis 0 6 16/04/19 01:29 1 (Keepalive) Gratis 0 7 16/04/19 03:29 1 (Keepalive) Gratis 0 8 04/16 /19 05:29 1 (Keepalive) Libre 0 9 16/04/19 06:04 0 (Info) Ocupado 0 10 16/04/19 08:04 1 (Keepalive) Ocupado 0 11 16/04/19 10:04 1 (Keepalive) Ocupado 0 12 16/04/19 12:04 1 (Keepalive) Ocupado 0 13 16/04/19 14:05 1 (Keepalive) Ocupado 0 14 16/04/19 15:58 7 (Solicitud RTC) Ocupado 0 15 16/04/19 15:59 7 (Solicitud RTC) Ocupado 0 16 16/04/19 17:59 1 (Keepalive) Ocupado 0 17 16/04/19 18:32 0 (Info) 0 0 18 04 /16/19 20:02 1 (Keepalive) 0 0 19 16/04/19 22:32 1 (Keepalive) 0 0 20 17/04/19 00:02 1 (Keepalive) 0 0 21 3.7.6 Valores predeterminados de f\u00e1brica Libelium proporciona a todos los nodos Smart Parking los par\u00e1metros predeterminados de f\u00e1brica. Par\u00e1metro Valor predeterminado Tiempo de reposo 1 min Tiempo de mantenimiento 2 horas Modo nocturno 0 (deshabilitado) Inicio del modo nocturno 0 horas Duraci\u00f3n del modo nocturno 6 horas Modo nocturno suspendido 5 min Par\u00e1metro Valor predeterminado Inicio del alcance del radar 20 cm (no debe cambiarse) Longitud del alcance del radar 60 cm (no debe cambiarse) cambiarse) Umbral de radar 30 (no debe cambiarse) Modo de uni\u00f3n LoRaWAN 1 (OTAA) LoRaWAN DevEUI valor predeterminado de f\u00e1brica \u00fanico LoRaWAN DevAddr, valor predeterminado de f\u00e1brica \u00fanico LoRaWAN NwkSKey valor predeterminado de f\u00e1brica \u00fanico LoRaWAN AppSKey valor predeterminado de f\u00e1brica \u00fanico LoRaWAN AppKey valor predeterminado de f\u00e1brica \u00fanico Valor predeterminado de f\u00e1brica \u00fanico de LoRaWAN AppEUI Puerto LoRaWAN 3 LoRaWAN ADR 0 (apagado) Retraso LoRaWAN RX1 1000 (no debe cambiarse) Subbanda LoRaWAN Mapa de bits de 8 bits 3.7.7 Configurar nuevos valores de par\u00e1metros Tanto la aplicaci\u00f3n Smart Devices como Libelium Cloud permiten al usuario actualizar los par\u00e1metros del programa al nodo: [LISTA] Smart Devices App: es una aplicaci\u00f3n Java de escritorio que implica abrir la carcasa del nodo y conectar un cable microUSB al nodo (la nueva configuraci\u00f3n se actualiza a la memoria del nodo a trav\u00e9s del cable USB). [LISTA] Libelium Cloud: permite cambiar remotamente algunos de los par\u00e1metros del nodo. En cuanto a los par\u00e1metros de tiempo y sensores, se establecen los mismos valores para todos los nodos fabricados por Libelium. Los valores predeterminados se pueden ver en la secci\u00f3n anterior. Sin embargo, el cliente puede n configure los ajustes de hora y sensor utilizando la aplicaci\u00f3n Smart Devices y el formulario de configuraci\u00f3n remota. Con respecto a los par\u00e1metros de LoRaWAN, todas las claves se generan aleatoriamente para cada nodo y se mantienen en secreto. El DevEUI configurado para el nodo es el EUI codificado de LoRaWAN que es \u00fanico para cada conjunto de chips de radio. Sin embargo, el cliente puede configurar/modificar todos los par\u00e1metros de LoRaWAN utilizando \u00fanicamente la aplicaci\u00f3n Smart Devices (el formulario de configuraci\u00f3n remota no lo permite). Para obtener m\u00e1s informaci\u00f3n sobre este asunto, consulte la secci\u00f3n \"Aplicaci\u00f3n para dispositivos inteligentes\". 4 Aplicaci\u00f3n Smart Devices La aplicaci\u00f3n Smart Devices es una herramienta de software desarrollada por Libelium que permite a los usuarios instalar nuevas versiones de firmware y programar la configuraci\u00f3n de dispositivos Libelium con unos pocos clics. Para obtener m\u00e1s informaci\u00f3n (instalaci\u00f3n y ejecuci\u00f3n), consulte el manual de la aplicaci\u00f3n Smart Devices: Aplicaci\u00f3n Smart Devices (actualizaciones binarias) Figura 4.0.1: La aplicaci\u00f3n Smart Devices est\u00e1 conectada al nodo a trav\u00e9s de USB 4.1 Configuraci\u00f3n de los par\u00e1metros de Smart Parking v2 4.1.1 C\u00f3mo conectar el nodo Smart Parking Antes de utilizar la aplicaci\u00f3n Smart Devices, debes tener en cuenta c\u00f3mo conectarla e inicializarla correctamente. Como se explica en la secci\u00f3n \u201cNodo de estacionamiento inteligente\u201d, existen 2 interruptores para gestionar el modo de funcionamiento del nodo. Para utilizar el nodo con la aplicaci\u00f3n Smart Devices, es obligatorio configurar el nodo en modo \"Arranque\" y luego encenderlo. Si cambi\u00f3 del modo \"Aplicaci\u00f3n\" al modo \"Arranque\", puede usar el bot\u00f3n de reinicio para aplicar el cambio y reiniciar el nodo en la secci\u00f3n del gestor de arranque. Nunca deje el dispositivo configurado en \u201cEncendido\u201d y \u201cArranque\u201d durante m\u00e1s tiempo del necesario: el gestor de arranque no proporciona ning\u00fan modo de suspensi\u00f3n y desperdiciar\u00e1 la bater\u00eda del dispositivo. Entonces, cuando termine de reconfigurar el dispositivo, configure el nodo en estado \"Apagado\". 4.1.2 Configuraci\u00f3n En la \u00faltima pesta\u00f1a, llamada Configuraci\u00f3n, est\u00e1n disponibles 2 par\u00e1metros: \u201cNombre de Usuario\u201d y \u201cContrase\u00f1a\u201d. Estas son las mismas credenciales necesarias para Libelium Cloud (https://cloud.libelium.com/app/login). Es obligatorio completar estos campos antes de comenzar a utilizar la aplicaci\u00f3n Smart Devices con el nodo Smart Parking. Recuerde hacer clic en el bot\u00f3n \"Guardar\" en la parte inferior de la aplicaci\u00f3n para almacenar las credenciales correctas. Figura 4.1.1: Pantalla de configuraci\u00f3n en Smart Parking v2 Existen algunas diferencias entre la 1\u00aa versi\u00f3n y la 2\u00aa. Debe escribir sus credenciales para autenticar sus nodos en Libelium Cloud. Debe tener una cuenta en Libelium Cloud para obtener su nombre de usuario y contrase\u00f1a. 4.1.3 Programador (cambiar par\u00e1metros del nodo) Figura 4 .1.2: Secci\u00f3n del programador Smart Parking v2 Los usuarios pueden leer y escribir todos los par\u00e1metros del nodo en esta secci\u00f3n. El proceso es bastante sencillo: basta con conectar el dispositivo al ordenador donde est\u00e1 instalado mediante el cable USB suministrado y encender el nodo en modo \u201cBoot\u201d. A continuaci\u00f3n, actualice la secci\u00f3n \"Configuraci\u00f3n de USB\" (esquina inferior izquierda), haciendo clic en el bot\u00f3n \"Actualizar\". Luego seleccione el puerto donde se ha conectado el dispositivo. Despu\u00e9s de eso, es una buena pr\u00e1ctica presionar el bot\u00f3n \"Cargar desde nodo\" para obtener la configuraci\u00f3n actual del dispositivo conectado. Figura 4.1.3: Configuraci\u00f3n USB de Smart Parking v2 El bot\u00f3n \"Cargar desde nodo\" leer\u00e1 todos los par\u00e1metros del nodo y mostrar\u00e1 la informaci\u00f3n en la aplicaci\u00f3n. Por otro lado, el bot\u00f3n \u201cEnviar a nodo\u201d sobrescribir\u00e1 la configuraci\u00f3n en el nodo. Todos los campos disponibles deben completarse con el formato adecuado. Si alg\u00fan par\u00e1metro no tiene un formato aceptable, se muestra una cruz roja cerca y no podr\u00e1 escribir la informaci\u00f3n en el nodo. Si la informaci\u00f3n introducida es v\u00e1lida se muestra un tick verde. Al cargar/enviar informaci\u00f3n al nodo, la aplicaci\u00f3n avisar\u00e1 al usuario a trav\u00e9s de una ventana emergente sobre el estado de la operaci\u00f3n. Figura 4.1.4: Botones \u201cCargar configuraci\u00f3n desde el nodo\u201d y \u201cEnviar configuraci\u00f3n al nodo\u201d Smart Parking v2 comparte la mayor\u00eda de los campos de configuraci\u00f3n con . Sin embargo, es importante conocer el prop\u00f3sito de cada campo en la configuraci\u00f3n. Para saber m\u00e1s sobre cada campo y c\u00f3mo funcionan, consulte el cap\u00edtulo \u201cNodo de estacionamiento inteligente\u201d. Configurar un \u201ctiempo de suspensi\u00f3n\u201d inferior a 1 minuto disminuye de manera importante la duraci\u00f3n de la bater\u00eda. 4.1.4 Actualizaci\u00f3n de firmware Dentro de esta pesta\u00f1a, los usuarios pueden seleccionar la versi\u00f3n de firmware para instalar en sus dispositivos. Figura 4.1.5: Secci\u00f3n de actualizaci\u00f3n de firmware y restablecimiento de f\u00e1brica para Smart Parking v2 La lista con todo el firmware disponible se carga cuando se inicia el programa, pero los usuarios pueden actualizarla manualmente haciendo clic en el bot\u00f3n \"Buscar nuevas actualizaciones de firmware\". Antes de instalar el firmware, es necesario descargarlo. Este proceso es muy sencillo, simplemente marca la casilla de verificaci\u00f3n de la versi\u00f3n que deseas instalar de la lista y haz clic en \u201cDescargar marcada\u201d. Es obligatorio realizar una carga de configuraci\u00f3n desde el nodo usando el bot\u00f3n disponible en la pesta\u00f1a antes de actualizar el firmware. Esta carga de informaci\u00f3n comprobar\u00e1 la configuraci\u00f3n actual antes de actualizar el firmware. En resumen, los pasos son: 1. Verifique su versi\u00f3n de firmware en la pesta\u00f1a Programador antes de actualizar un nuevo firmware: 1. No Los des con firmware v1.1.x son compatibles con los firmwares v1.1.x y v1.2.x 2. Los nodos con firmware v1.0.x solo son compatibles con los firmwares v1.0.x 2. Haga clic en \u201cBuscar nuevo Actualizaciones de firmware\u201d para cargar nuevas actualizaciones de firmware 3. Marque uno o m\u00e1s firmwares para descargar de la lista de firmware en el lado izquierdo 4. Haga clic en \u201cDescargar marcado\u201d para descargar los firmwares seleccionados Figura 4.1.6: Descargar nuevas versiones de firmware Ahora Se descargan los archivos de firmware. El men\u00fa desplegable mostrar\u00e1 los archivos de firmware disponibles para instalar en el nodo. Cuando se descarga el archivo, se muestra un icono de disco cerca de \u00e9l, lo que indica que se ha descargado. En la secci\u00f3n \"Instalar firmware\", puede seleccionar el firmware a instalar y luego presionar \"Instalar\" para ejecutar la instalaci\u00f3n. La aplicaci\u00f3n mostrar\u00e1 un mensaje emergente sobre el estado de la instalaci\u00f3n del firmware. Recuerde que el puerto USB debe estar seleccionado en la pesta\u00f1a del programador. Figura 4.1.7: Instalaci\u00f3n del firmware Tambi\u00e9n puede eliminar los archivos de firmware descargados seleccionando la casilla de verificaci\u00f3n de la lista y luego haciendo clic en el bot\u00f3n \"Eliminar marcado\". 4.1.5 Restablecimiento de f\u00e1brica El restablecimiento de f\u00e1brica es la \u00faltima opci\u00f3n para recuperar un dispositivo Smart Parking v2 que no funciona. Realiza un reinicio completo seguido de un reinicio del firmware y la configuraci\u00f3n. Para obtener el archivo de configuraci\u00f3n de recuperaci\u00f3n, env\u00ede un correo electr\u00f3nico indicando su n\u00famero de pedido y el equipo de servicio t\u00e9cnico le enviar\u00e1 el archivo de configuraci\u00f3n necesario. Para este proceso es obligatorio descargar un firmware, como se explica en el apartado anterior \u201cActualizaci\u00f3n de firmware\u201d. Luego seleccione un firmware en el men\u00fa desplegable y presione el bot\u00f3n \"Restablecer valores de f\u00e1brica\". Figura 4.1.8: Proceso de restablecimiento de f\u00e1brica para Smart Parking v2 Paso 1 Al presionar el bot\u00f3n \"Restablecer valores de f\u00e1brica\" \u200b\u200bse mostrar\u00e1 una ventana del explorador de archivos para seleccionar el archivo de configuraci\u00f3n proporcionado por Libelium. Una vez que haya seleccionado este archivo, aparecer\u00e1 un mensaje pregunt\u00e1ndole si desea iniciar el proceso. Si se selecciona la opci\u00f3n \"S\u00ed\", se inicia el proceso de restablecimiento de f\u00e1brica. Figura 4.1.9: Proceso de restablecimiento de f\u00e1brica para Smart Parking v2 Paso 2 Cuando finaliza el Restablecimiento de f\u00e1brica, otro mensaje informa sobre el resultado final: Figura 4.1.10: Restablecimiento de f\u00e1brica finalizado para Smart Parking v2 Despu\u00e9s de este proceso, puede configurar su nodo nuevamente en la pesta\u00f1a \u201cProgramador\u201d. 5 Configuraci\u00f3n del servidor de red LoRaWAN Libelium actualmente admite varios servicios del servidor de red LoRaWAN. En esta secci\u00f3n, explicamos c\u00f3mo configurarlos. Recuerda que cualquier red LoRaWAN necesita un Servidor de Red, por lo que debes elegir una de las opciones iones arriba. No solo los nodos Smart Parking de Libelium necesitan un servidor de red: cualquier dispositivo LoRaWAN (de Libelium u otra empresa) necesita un servidor de red, es solo una pieza de la arquitectura LoRaWAN. 5.1 Loriot Esta secci\u00f3n explica c\u00f3mo enrutar la informaci\u00f3n de Loriot a Libelium Cloud utilizando el protocolo HTTPS. La \u201ccuenta comunitaria\u201d gratuita no permite enlaces descendentes remotos. Por lo tanto, se debe adquirir una licencia comercial para poder utilizar mensajes de enlace descendente remoto para sincronizaci\u00f3n RTC, funci\u00f3n de modo nocturno y actualizaci\u00f3n de par\u00e1metros de nodo a trav\u00e9s del formulario de configuraci\u00f3n remota. 5.1.1 Iniciar sesi\u00f3n Inicie sesi\u00f3n en la plataforma Loriot, seleccionando la ubicaci\u00f3n de su servidor. Figura 5.1.1: P\u00e1gina web de inicio de sesi\u00f3n de Loriot 5.1.2 Crear una nueva aplicaci\u00f3n de Loriot Una vez que haya seleccionado la ubicaci\u00f3n del servidor, se mostrar\u00e1 un nuevo mensaje solicitando sus credenciales. Despu\u00e9s de iniciar sesi\u00f3n, los usuarios deben crear una nueva aplicaci\u00f3n en el panel de Loriot. Para ello es necesario hacer clic en \u201cAplicaciones\u201d en la barra lateral izquierda y luego en la opci\u00f3n \u201cNueva Aplicaci\u00f3n\u201d ubicada en la misma barra: Figura 5.1.2: Creaci\u00f3n de una aplicaci\u00f3n Llene el formulario para crear la aplicaci\u00f3n deseada en Loriot: [LISTA] Nuevo nombre de la aplicaci\u00f3n: Nombre para identificar la aplicaci\u00f3n. [LISTA] Formato de salida: \u201cWebsocket\u201d est\u00e1 seleccionado por defecto y no es posible cambiarlo en este formulario. C\u00f3mo cambiarlo se explicar\u00e1 en el siguiente paso. [LISTA] Capacidad de dispositivos: N\u00famero m\u00e1ximo de dispositivos a registrar en esta aplicaci\u00f3n. El valor m\u00e1ximo depender\u00e1 del tipo de cuenta que tengas. [LISTA] Visibilidad: Esta casilla de verificaci\u00f3n permite configurar la aplicaci\u00f3n como \u201cp\u00fablica\u201d o \u201cprivada\u201d. Figura 5.1.3: Nuevo formulario de solicitud 5.1.3 Datos de salida: URL de Libelium Cloud Una vez creada la aplicaci\u00f3n, se mostrar\u00e1 el panel. Vaya a \u201cSalidas de la aplicaci\u00f3n\u201d > haga clic en \u201cAdministrar salidas\u201d > haga clic en \u201cAgregar nueva salida\u201d: Figura 5.1.4: Crear una nueva salida de la aplicaci\u00f3n Seleccione \u201cHTTP Push\u201d de la lista y complete el formulario que se muestra en el lado derecho. En el campo \"URL de destino para POST\", escriba la URL a la que Loriot debe enviar datos (https://api.libelium.com/cloud/parking/v2/services/loriot). Adem\u00e1s, los usuarios pueden agregar un encabezado de autorizaci\u00f3n en \u201cValor de encabezado de autorizaci\u00f3n personalizado\u201d para aumentar la seguridad en las comunicaciones, de modo que el servidor final solo acepte la informaci\u00f3n de una cuenta autorizada. Finalmente, haga clic en el bot\u00f3n \u201cConfirmar cambio\u201d para guardar la informaci\u00f3n. Figura 5.1.5: Configuraci\u00f3n HTTP Push de Loriot Para ello, puede generar su propia clave API de Libelium en el archivo correspondiente. Secci\u00f3n adicional de la nube: 5.1.4 C\u00f3mo eliminar aplicaciones Loriot no utilizadas Se mostrar\u00e1 una lista con todas las salidas de las aplicaciones en la ventana \u201cSalidas de las aplicaciones\u201d. Se recomienda eliminar las salidas no utilizadas y mantener solo \"HTTP Push\" en la lista. El procedimiento para eliminar todas las dem\u00e1s aplicaciones es hacer clic en el bot\u00f3n de puntos suspensivos deseado de la aplicaci\u00f3n \"...\" y seleccionar la opci\u00f3n \"Eliminar\". Una ventana emergente le pedir\u00e1 que confirme la operaci\u00f3n. Figura 5.1.6: Eliminar salidas de aplicaciones no utilizadas 5.1.5 C\u00f3mo crear un \u00fanico dispositivo manualmente Haga clic en el men\u00fa izquierdo \"Dispositivos\" para mostrar la lista de dispositivos. Haga clic en el bot\u00f3n \u201cRegistrar nuevo dispositivo\u201d para agregar un nuevo dispositivo: Figura 5.1.7: Registrar nuevo dispositivo Se mostrar\u00e1 un nuevo formulario para crear el nuevo dispositivo asociado a la aplicaci\u00f3n. De esta forma es posible elegir diferentes procesos de inscripci\u00f3n basados \u200b\u200ben OTAA o ABP. As\u00ed, dependiendo de la opci\u00f3n elegida, ser\u00e1 obligatorio insertar diferentes EUI o claves. Consulte \"Protocolo y par\u00e1metros LoRaWAN\" para comprender todos los par\u00e1metros involucrados en este formulario. Figura 5.1.8: Formulario de nuevo dispositivo 5.1.6 Aprovisionamiento por lotes de nodos en Loriot Dentro de la aplicaci\u00f3n Loriot, haga clic en \"Importaci\u00f3n masiva\" y luego haga clic en \"Cargar archivo\" para registrar varios dispositivos a la vez. Solicita un archivo CSV que debe exportarse desde el SCM. Consulte la secci\u00f3n \"Libelium Cloud\" para obtener m\u00e1s informaci\u00f3n sobre c\u00f3mo exportar este archivo CSV que incluye todas las credenciales OTAA de los nodos necesarias para la importaci\u00f3n directa por lotes. Figura 5.1.9: Importaci\u00f3n masiva de Loriot El archivo CSV para 'N' dispositivos debe respetar el siguiente formato: <DevEUI_1>,<AppEUI_1>,<AppKey_1>,<Serial_1> <DevEUI_2>,<AppEUI_2>,<AppKey_2>,< Serial_2> <DevEUI_3>,<AppEUI_3>,<AppKey_3>,<Serial_3> ... <DevEUI_N>,<AppEUI_N>,<AppKey_N>,<Serial_N> 5.2 Actility Esta secci\u00f3n explica c\u00f3mo enrutar informaci\u00f3n de Actility a Libelium Cloud usando el protocolo HTTPS. En primer lugar, debe acceder al portal ThingPark de Actility e iniciar sesi\u00f3n. En el portal principal, debe ir a la secci\u00f3n \u201cAplicaci\u00f3n ThingPark\u201d y acceder al \u201cAdministrador de dispositivos\u201d: Figura 5.2.1: Acceso al men\u00fa \u201cAdministrador de dispositivos\u201d Actility requiere un \u201cServidor de Aplicaciones\u201d y un \u201cperfil de enrutamiento AS\u201d para establecer la comunicaci\u00f3n con Libelium Cloud. Estos 2 elementos son necesarios antes de iniciar el servicio por 1\u00aa vez, y ser\u00e1n la base para crear nuevos dispositivos. 5.2.1 C\u00f3mo crear un nuevo servidor de aplicaciones A partir de la ventana principal de ThingPark Device Manager, deber\u00e1 crear un nuevo \"Servidor de aplicaciones\" haciendo clic en \"Aplicar\". ation Servers\u201d: Figura 5.2.2: Men\u00fa Administrador de dispositivos La primera secci\u00f3n le permite crear un nuevo \u201cServidor de aplicaciones\u201d. Luego, la segunda secci\u00f3n muestra una lista de todos los \u201cServidores de aplicaciones\u201d creados. Haga clic en el bot\u00f3n \u201cCrear\u201d en la primera secci\u00f3n para crear un nuevo \u201cServidor de aplicaciones\u201d: Figura 5.2.3: Men\u00fa Servidores de aplicaciones En el campo \u201cNombre\u201d defina el nombre de su Servidor de aplicaciones. En el campo \u201cTipo\u201d, debe seleccionar \u201cServidor de aplicaciones HTTP\u201d. Finalmente, haga clic en el bot\u00f3n \u201cCrear\u201d para continuar: Figura 5.2.4: Nombre del servidor de aplicaciones Aparece una nueva ventana, donde se copia el nombre del popup anterior. En el campo \u201cTipo de contenido\u201d debe seleccionar \u201cJSON\u201d. Luego haga clic en el bot\u00f3n \u201cAgregar\u201d en la secci\u00f3n \u201cAgregar una ruta\u201d para crear el enlace al servidor de devoluci\u00f3n de llamadas instalado: Figura 5.2.5: Formulario del servidor de aplicaciones Se generar\u00e1 una secci\u00f3n \u201cRuta\u201d con un nuevo formulario para completar. Solo haga clic en el bot\u00f3n \u201cAgregar\u201d para continuar: Figura 5.2.6: Formulario de ruta Aparece un nuevo popup. En el campo \u201cDestino\u201d se debe introducir la URL del servidor donde se van a enviar los datos (https://api.libelium.com/cloud/parking/v2/services/actility). Pulsar el bot\u00f3n \u201cA\u00f1adir\u201d para guardar la informaci\u00f3n: Figura 5.2.7: Formulario Destino Navegar de nuevo al formulario Servidor de aplicaciones, pulsar en \u201cGuardar\u201d para crear el \u201cServidor de aplicaciones\u201d. 5.2.2 C\u00f3mo crear un nuevo perfil de enrutamiento AS El perfil de enrutamiento del Servidor de aplicaciones (AS) define c\u00f3mo se comportar\u00e1 un \u201cServidor de aplicaciones\u201d creado previamente. Para crear un nuevo \u201cPerfil de enrutamiento AS\u201d en el Administrador de dispositivos, pulsar el bot\u00f3n \u201cPerfiles de enrutamiento AS\u201d en el men\u00fa de la barra lateral izquierda: Figura 5.2.8: Formulario Destino A continuaci\u00f3n se debe pulsar el bot\u00f3n \u201cA\u00f1adir\u201d en la primera secci\u00f3n. A continuaci\u00f3n, en la segunda secci\u00f3n, se mostrar\u00e1 una lista con todos los \u201cPerfiles de enrutamiento AS\u201d existentes: Figura 5.2.9: Perfiles de enrutamiento AS En el campo \u201cNombre\u201d escribir el nombre del perfil de enrutamiento AS. En el campo \u201cTipo\u201d, seleccione LoRaWAN. Luego haga clic en el bot\u00f3n \u201cCrear\u201d para continuar el proceso: Figura 5.2.10: Nombre del perfil de enrutamiento AS En la nueva ventana, puede leer el \u201cID del perfil de enrutamiento AS\u201d que ser\u00e1 necesario para la importaci\u00f3n por lotes. Adem\u00e1s, marque la casilla \u201cEs predeterminado\u201d y haga clic en el bot\u00f3n \u201cAgregar\u201d: Figura 5.2.11: Ruta del perfil de enrutamiento AS Aparecer\u00e1 una nueva ventana emergente con 2 par\u00e1metros para completar. \u201cTipo\u201d es el tipo de aplicaci\u00f3n para nuestro destino, se debe seleccionar \u201cServidor de aplicaciones local\u201d. En el campo desplegable \u201cDestino\u201d, se mostrar\u00e1n todos los servidores de aplicaciones disponibles. Por lo tanto, el \u201cServidor de aplicaciones\u201d correcto \u201dcreado previamente debe ser seleccionado: Figura 5.2.12: Agregar el servidor de aplicaciones creado como \u201cdestino\u201d para el perfil de enrutamiento. Navegue nuevamente al formulario del perfil de enrutamiento AS, haga clic en \u201cGuardar\u201d para crearlo. Este proceso debe completarse solo una vez. A partir de este momento los clientes podr\u00e1n a\u00f1adir dispositivos al servicio. 5.2.3 C\u00f3mo crear nuevos dispositivos manualmente Una vez creado el \u201cServidor de aplicaciones\u201d y el \u201cPerfil de enrutamiento AS\u201d, puede crear nuevos dispositivos. En el men\u00fa principal de ThingPark, haz clic en la opci\u00f3n \u201cDispositivos\u201d. Luego haga clic en el bot\u00f3n \u201cCrear\u201d: Figura 5.2.13: Crear nuevos dispositivos Se desplegar\u00e1 un nuevo formulario para definir los par\u00e1metros del nuevo dispositivo: Datos administrativos [LISTA] Nombre del dispositivo: Nombre para identificar el dispositivo [LISTA] Marcador: Icono para identificar el dispositivo en la lista de mapas [LISTA] Informaci\u00f3n administrativa: Informaci\u00f3n relevante del dispositivo [LISTA] Ubicaci\u00f3n administrativa: Ubicaci\u00f3n del dispositivo [LISTA] Indicador de movimiento: Lista con varias opciones Identificaci\u00f3n del dispositivo [LISTA] Fabricante: Seleccione \u201cGen\u00e9rico\u201d \u201d. [LISTA] Modelo: Seleccione la regi\u00f3n correspondiente: \u2013 LoRaWAN EU863870: LORA/GenericA.1.0.2a_ETSI_Rx2SF12 \u2013 LoRaWAN US902928: LORA/GenericA.1.0.2a_FCC_Rx2SF12 \u2013 LoRaWAN IN865867: LORA/GenericA.1revB_IN865_Rx2SF12 \u2013 AU915928: LORA/GenericA.1revB_AU915_Rx2SF12 \u2013 LoRaWAN AS923: LORA/GenericA.1_AS923_Rx2SF10 [LISTA] Activaci\u00f3n del dispositivo: seleccione \u201cActivaci\u00f3n por aire (OTAA)\u201d si se utilizan los par\u00e1metros predeterminados. ABP es la otra opci\u00f3n. [LISTA] DevEUI: Dispositivo EUI, direcci\u00f3n IEEE EUI64 \u00fanica a nivel mundial. [LISTA] AppEUI: Identificador de la aplicaci\u00f3n del dispositivo (obligatorio para OTAA). [LISTA] Formato de clave: debe ser \"texto claro\" para el formato de clave no cifrado. [LISTA] AppKey: Clave de aplicaci\u00f3n de 16 bytes (obligatoria para OTAA). Par\u00e1metros de red [LISTA] Plan de conectividad: seleccione un plan de conectividad en el men\u00fa desplegable. [LISTA] DevAddr: Seleccione \u201cAsignado por el servidor de red\u201d. Manejo de la capa de aplicaci\u00f3n [LISTA] Perfil de enrutamiento del servidor de aplicaciones: seleccione el \u201cServidor de aplicaciones\u201d creado anteriormente. Figura 5.2.14: Ingrese todos los par\u00e1metros del dispositivo Finalmente haga clic en el bot\u00f3n \"Crear\" para guardar la informaci\u00f3n del dispositivo. 5.2.4 Aprovisionamiento por lotes de nodos en Actility Es posible registrar varios nodos a la vez usando el bot\u00f3n \u201cImportar\u201d: Figura 5.2.15: Importar dispositivos Se muestra una nueva ventana para importar un archivo CSV con todos los dispositivos a importar : Figura 5.2.16: Importar archivo CSV En cuanto al formato del archivo CSV, debe comenzar desde el archivo CSV exportado desde el SCM. Consulte \u201cLibeli Secci\u00f3n \u201cGesti\u00f3n de la nube\u201d para obtener m\u00e1s informaci\u00f3n sobre c\u00f3mo exportar este archivo CSV que incluye todas las credenciales OTAA de los nodos necesarias para la importaci\u00f3n directa por lotes. Luego, debe tener en cuenta que Actility necesita que se incluya m\u00e1s informaci\u00f3n en ese archivo CSV. El CSV que se importar\u00e1 debe seguir el siguiente formato (15 columnas). El archivo CSV para 'N' dispositivos debe respetar el siguiente formato: Donde: [LISTA] CREATE_OTAA: Siempre debe ser el mismo para importar los dispositivos utilizando el modo de uni\u00f3n OTAA. [LISTA] <DevEUI>: Este es el EUI del dispositivo exportado desde el archivo CSV de Libelium SCM. No debe cambiarse. [LISTA] <DevPofile>: Este campo est\u00e1 relacionado con la regi\u00f3n LoRaWAN del nodo. Posibilidades seg\u00fan la versi\u00f3n: \u2013 LoRaWAN EU863870: LORA/GenericA.1.0.2a_ETSI_Rx2SF12 \u2013 LoRaWAN US902928: LORA/GenericA.1.0.2a_FCC_Rx2SF12 \u2013 LoRaWAN IN865867: LORA/GenericA.1revB_IN865_Rx2SF12 \u2013 LoRaWAN AU915928: LORA/GenericA.1revB_AU915_Rx2SF12 \u2013 LoRaWAN AS923: LORA/GenericA.1_AS923_Rx2SF10 [LISTA] <AppEUI>: Esta es la EUI de la aplicaci\u00f3n exportada desde el archivo CSV de Libelium SCM. No debe cambiarse. [LISTA] <AppKey>: Esta es la clave de la aplicaci\u00f3n exportada desde el archivo CSV de Libelium SCM. No debe cambiarse. [LISTA] <AS_profile_ID>: Este es el \u201cAS \u200b\u200brouted profile ID\u201d de Actility que pertenece a la cuenta de cada cliente. Se puede leer desde el perfil cuando se crea por primera vez. [LISTA] <ConnPlan>: Esto debe configurarse como \u201cdevcs/testing\u201d. [LISTA] <Name>: Nombre de cada dispositivo (opcional). Ejemplo para algunos nodos Smart Parking EU (LoRaWAN EU863870). Supongamos que TWA_123 era el \u201cAS \u200b\u200brouted profile ID\u201d proporcionado por Actility para nuestra aplicaci\u00f3n: 5.3 Estaci\u00f3n base Libelium Esta secci\u00f3n explica c\u00f3mo enrutar informaci\u00f3n en una estaci\u00f3n base Libelium a Libelium Cloud usando servidores de red de terceros. 5.3.1 Servidores de red LoRa compatibles Esta puerta de enlace LoRaWAN se puede configurar de varias maneras para enrutar datos LoRa a diferentes servidores de red. Esta secci\u00f3n se centra en la configuraci\u00f3n de la puerta de enlace para conectarse a la nube de Libelium a trav\u00e9s del servidor de red Loriot. La documentaci\u00f3n del fabricante puede ayudar a los clientes desde el primer momento a acceder al dispositivo y desplegar su propia red aqu\u00ed. 5.3.2 Configurar los ajustes de la red LoRaWAN Para conectarse a Loriot, el reenviador de paquetes Semtech est\u00e1 instalado en el gateway. Se puede seleccionar y configurar en la secci\u00f3n Red LoRa > Ajustes de red. La direcci\u00f3n del servidor ser\u00e1 la misma donde se crea la red y la aplicaci\u00f3n de la cuenta del cliente. Puerto de subida y bajada m Debe configurarse en 1780. Figura 5.3.1: Configuraci\u00f3n de red LoRaWAN 5.3.3 Registrar la puerta de enlace en Loriot Agregar una nueva puerta de enlace en Loriot proporciona varios modelos, entre los cuales el usuario debe elegir. Aunque este modelo de puerta de enlace no se encuentra entre ellos, el Semtech Packet Forwarder est\u00e1 disponible para que el usuario lo configure con esta puerta de enlace: Figura 5.3.2: Registro de la puerta de enlace Loriot Para conectar la puerta de enlace a Loriot, la direcci\u00f3n MAC f\u00edsica y el EUI de la puerta de enlace deben configurarse en el proceso de registro. Figura 5.3.3: Registro de Loriot Gateway La direcci\u00f3n MAC del dispositivo se puede encontrar en la secci\u00f3n Red > Interfaz WAN. Figura 5.3.4: Registro de Loriot Gateway El EUI de Gateway se puede encontrar en la secci\u00f3n Red LoRa > Configuraci\u00f3n de red. Figura 5.3.5: Registro de la puerta de enlace de Loriot Despu\u00e9s del registro, se puede configurar el plan de frecuencia en la secci\u00f3n de la puerta de enlace. Figura 5.3.6: Registro de Loriot Gateway 6 Sistema de nube Opciones del sistema de nube: Figura 6.0.1: Arquitectura de estacionamiento inteligente 6.1 Libelium Cloud Caracter\u00edsticas de Libelium Cloud: [LISTA] Soluci\u00f3n SaaS [LISTA] Almacene, visualice y analice los datos recibidos de su calidad del aire Dispositivos de estaci\u00f3n. [LISTA] Administre de forma remota todos sus dispositivos. [LISTA] Obtenga claves de cifrado LoRaWAN. [LISTA] Conectores para env\u00edo de datos a Clouds del mercado: Amazon Web Services, Microsoft Azure,\u2026 Figura 6.1.1: Libelium Cloud 6.2 FIWARE Caracter\u00edsticas FIWARE: [LISTA] Soluci\u00f3n Onpremise [LISTA] ChirpStack como Servidor de Red LoRaWAN [LISTA] Visualizaci\u00f3n proporcionado Figura 6.2.1: FIWARE como plataforma en la nube Figura 6.2.2: Visualizaci\u00f3n proporcionada por Libelium en soluciones FIWARE 6.3 Plataforma de terceros del cliente Caracter\u00edsticas de la plataforma de terceros del cliente: [LISTA] Soluci\u00f3n local [LISTA] Cualquier servidor de red LoRaWAN administrado por el usuario [ LISTA] La documentaci\u00f3n de decodificaci\u00f3n de marcos es proporcionada por Libelium Figura 6.3.1: Plataforma de terceros del cliente Advertencia: La administraci\u00f3n de la base de datos, la visualizaci\u00f3n y la configuraci\u00f3n remota deben ser desarrolladas por el Cliente 7 Implementaci\u00f3n e instalaci\u00f3n 7.1 Gu\u00eda paso a paso Una vez que reciba el lote de Smart Parking, los pasos Los involucrados en el despliegue de la red son: 1. Aprovisionamiento de nodos: una vez que el cliente posee una licencia de servidor de red LoRaWAN, es obligatorio registrar los nodos con el identificador configurado y las claves para cada nodo. El cliente debe decidir si utiliza el identificador \u00fanico LoRaWAN predeterminado de f\u00e1brica y las claves privadas aleatorias proporcionadas por Libelium o prefiere configurar su propio identificador y claves. Debe tener en cuenta que cada nodo se proporciona \"listo para instalar\" h Identificador y claves predeterminados de f\u00e1brica. Si se desean un identificador y claves configurados por el cliente, cada nodo deber\u00e1 configurarse por separado mediante la aplicaci\u00f3n Smart Devices. Esta 2\u00aa opci\u00f3n aumenta el tiempo de aprovisionamiento. Por lo tanto, Libelium recomienda utilizar las ID y claves predeterminadas. Si se utilizan las claves predeterminadas de f\u00e1brica, se puede utilizar un archivo CSV exportado desde Libelium Cloud para facilitar la importaci\u00f3n masiva al servidor de red LoRaWAN. Busque los ID/claves predeterminados de f\u00e1brica en la secci\u00f3n de herramientas Claves de nodo. Consulte el cap\u00edtulo \"Aplicaci\u00f3n para dispositivos inteligentes\" para obtener m\u00e1s informaci\u00f3n sobre la aplicaci\u00f3n para dispositivos inteligentes. 2. Libelium Cloud: Se utiliza para recibir, almacenar y explotar datos. El usuario tambi\u00e9n puede realizar la configuraci\u00f3n remota de nodos y reenviar datos a una nube de terceros. El servidor de red LoRaWAN debe configurarse para reenviar correctamente todos los paquetes a Libelium Cloud. 3. Instalaci\u00f3n de nodos: Cada nodo debe colocarse en el lugar de estacionamiento adecuado y luego seguir el protocolo de \u201cinicio del im\u00e1n\u201d explicado en la secci\u00f3n \u201cProceso de inicio del im\u00e1n\u201d. Figura 7.1.1: Arquitectura de red de Smart Parking 7.2 C\u00f3mo colocar los nodos El lugar de instalaci\u00f3n correcto es el centro de la plaza de aparcamiento para garantizar la mejor detecci\u00f3n. Es posible instalar los nodos en diferentes configuraciones de espacios de estacionamiento: [LISTA] Paralelo [LISTA] Perpendicular [LISTA] En \u00e1ngulo Figura 7.2.1: Espacios de estacionamiento paralelos Figura 7.2.2: Espacios de estacionamiento perpendiculares Es importante tener en cuenta que los espacios de estacionamiento Los espacios deben estar delimitados por l\u00edneas de manera que el nodo quede situado en el centro de la zona de aparcamiento. Colocar los nodos sin definiciones de l\u00ednea puede provocar un mal comportamiento. 7.3 Instalaci\u00f3n del nodo El usuario puede elegir entre diferentes tipos de instalaci\u00f3n del nodo. Esta tabla resume los pros y los contras: Instalaci\u00f3n en superficie Instalaci\u00f3n semienterrada Tipo de recinto B\u00f3veda B\u00f3veda Presencia del nodo sobre el suelo Nodo completo (40,25 mm) Parte del nodo (6 mm) Inmunidad a la lluvia S\u00ed S\u00ed Inmunidad a los charcos S\u00ed S\u00ed Inmunidad al vandalismo/robo Media Alta Quitanieves inmunidad No es posible Proceso de instalaci\u00f3n, r\u00e1pido y f\u00e1cil Se necesitan herramientas especiales Herramientas necesarias Taladro normal Taladro industrial de corona grande. Epoxy. Se puede desmontar para mantenimiento S\u00ed No Nota: Desde 2022, el tipo de instalaci\u00f3n \u201csubterr\u00e1nea\u201d ya no es compatible. 7.3.1 Instalaci\u00f3n del nodo en superficie Figura 7.3.1: Instalaci\u00f3n de anclajes y fijaci\u00f3n qu\u00edmica paso a paso En primer lugar, marque 4 agujeros en el asfalto. Seleccione una zona lo m\u00e1s plana y regular posible, evite irregularidades en el terreno. Deber\u00edas colocar el en cierre en la ubicaci\u00f3n final y use los 4 agujeros como referencia para perforar 4 peque\u00f1as marcas en el suelo. Tambi\u00e9n puedes dibujar 4 puntos con tinta. Figura 7.3.2: Marcado de los orificios para el nodo Luego contin\u00fae con la instalaci\u00f3n del fijador qu\u00edmico paso a paso como se describe arriba. Adem\u00e1s, en el siguiente v\u00eddeo pod\u00e9is ver c\u00f3mo se realiza la instalaci\u00f3n de fijaci\u00f3n qu\u00edmica. Paso 1: taladra los agujeros. El di\u00e1metro de la broca debe ser de W=14 mm como m\u00ednimo. Intente perforar lo m\u00e1s verticalmente posible para permitir la mejor instalaci\u00f3n del gabinete. La longitud del agujero debe ser de aproximadamente H=85 mm. Paso 2, 3 y 4: Quite el polvo y los materiales sueltos. Retire todo el polvo y las peque\u00f1as piedras del interior de los 4 agujeros creados durante la operaci\u00f3n de perforaci\u00f3n. Esto es importante para permitir que los anclajes bajen completamente. Puede limpiar cada orificio mec\u00e1nicamente y luego utilizar una botella de spray (botella de aire a alta presi\u00f3n). Aseg\u00farese de que la profundidad real del agujero sea suficiente. Paso 5: Inyectar el fijador qu\u00edmico. El fijador qu\u00edmico se inyectar\u00e1 con cuidado en los 4 orificios. Debes tener en cuenta que este adhesivo qu\u00edmico debe rellenar el espacio complementario que deja el anclaje en el agujero. Por lo tanto, no es necesario rellenar completamente todo el orificio con adhesivo porque no queda espacio para el anclaje. La cantidad de adhesivo qu\u00edmico a inyectar depender\u00e1 de las dimensiones de los agujeros. Paso 6: Inserta los anclajes. Una vez inyectado el adhesivo, se debe introducir con cuidado el anclaje en el agujero. Girar el ancla con la mano mientras se inserta es una buena pr\u00e1ctica. Por tanto, el adhesivo rellena y completa todo el espacio vac\u00edo que deja el anclaje en el agujero. Una vez insertado correctamente el anclaje, es posible que algo de adhesivo sobresalga del agujero. Este adhesivo residual debe eliminarse de la instalaci\u00f3n para que no quede adhesivo adicional y la instalaci\u00f3n del anclaje quede limpia y suave. Paso 7: Termine la instalaci\u00f3n de los anclajes. Los anclajes tienen una rosca interna para atornillar los tornillos. Insertar los anclajes con los tornillos parcialmente insertados puede ser una buena pr\u00e1ctica para colocar el anclaje correctamente alineado dentro del orificio (es decir, puedes usar el tornillo como herramienta si est\u00e1 parcialmente insertado dentro del anclaje). Adem\u00e1s, si el tornillo est\u00e1 dentro del anclaje, se evita que el adhesivo entre accidentalmente dentro del anclaje. Despu\u00e9s de limpiar el adhesivo restante del orificio, el usuario debe esperar un tiempo hasta que la resina qu\u00edmica est\u00e9 s\u00f3lida y estable. Despu\u00e9s de este per\u00edodo de tiempo, se pueden quitar los tornillos de los anclajes y la instalaci\u00f3n est\u00e1 finalizada. d. Paso 8: Coloca el nodo. Coloca el c\u00edrculo de goma negro en el suelo. Para permitir el correcto atornillado de los tornillos en el interior de los anclajes, asegurarse de que no haya polvo en la rosca interna del anclaje. Instale el nodo en su posici\u00f3n final y atornille los 4 tornillos especiales (antivand\u00e1licos) suministrados. Se recomiendan tornillos antivand\u00e1licos para evitar problemas: cualquiera podr\u00eda desenroscar un nodo si lo fija con tornillos est\u00e1ndar. 7.3.2 Instalaci\u00f3n de nodo semisubterr\u00e1neo Esta es una instalaci\u00f3n posible para proporcionar inmunidad al vandalismo y tambi\u00e9n inmunidad a la lluvia/charcos. As\u00ed, el nodo parcialmente insertado en el suelo y el recinto abovedado minimizan los problemas de agua. Respecto al proceso de instalaci\u00f3n, los siguientes pasos explican c\u00f3mo instalar correctamente el dispositivo: Paso 1: Taladra el agujero. Utilice una sierra perforadora u otra herramienta espec\u00edfica para perforar un agujero en el pavimento lo suficientemente grande para el recinto (di\u00e1metro m\u00ednimo 202 mm). Intente perforarlo lo suficientemente profundo como para insertar el nodo Smart Parking por completo sin sobresalir de la superficie, aseg\u00farese de que el cerramiento quede por debajo de la l\u00ednea del pavimento aproximadamente 10 mm. Figura 7.3.3: C\u00f3mo hacer un agujero en el pavimento Paso 2: Coloque el nodo en el agujero del pavimento. Debajo del dispositivo se debe extender una capa de cemento para elevar el dispositivo a la posici\u00f3n horizontal correcta independientemente de la profundidad del agujero. El di\u00e1metro del agujero debe ser de al menos 202 mm. Paso 3: llena el agujero. Finalmente, es necesario fijar el nudo al pavimento mediante resina epoxi (com\u00fanmente utilizada para rellenar fisuras de carreteras). Esta resina deber\u00e1 rellenar todo el espacio entre cerramiento y pavimento. Adem\u00e1s, debe cubrir completamente la parte superior del recinto garantizando protecci\u00f3n contra el agua, las malas condiciones ambientales y el vandalismo. La resina Epoxi testada por Libelium proporciona un tiempo de curado de alrededor de 612 horas a 20 \u00baC y 50% HR. Por lo que la instalaci\u00f3n del parking no debe utilizarse antes de este tiempo de curado. En esta instalaci\u00f3n, es fundamental que la parte superior del gabinete no est\u00e9 cubierta con epoxi u otro material. S\u00f3lo se pueden tapar las correderas laterales, el centro del nodo debe estar limpio para permitir que la se\u00f1al del radar funcione correctamente. En el paso de colocaci\u00f3n de nudos, el cerramiento abovedado deber\u00e1 sobrepasar la capa de pavimento horizontal en 67 mm aproximadamente. La siguiente figura muestra c\u00f3mo se coloca el nodo: Figura 7.3.4: Instalaci\u00f3n del nodo semienterrado Paso 4: Inicie el nodo usando el im\u00e1n. Contin\u00fae con el proceso de \u201cInicio del im\u00e1n\u201d para inicializar el nodo. 7.4 Inicio del nodo Despu\u00e9s de instalar el nodo, debe seguir los pasos de \u201cInicio del im\u00e1n\u201d explicados en la secci\u00f3n \u201cProceso de inicio del im\u00e1n\u201d. Este proceso se basa en 3 reinicios magn\u00e9ticos consecutivos esperando al menos un segundo entre cada reinicio. En el futuro, si es necesario restablecer el nodo manualmente, solo ser\u00e1 necesario restablecer un \u00fanico im\u00e1n. Una vez iniciado el nodo, comenzar\u00e1 a ejecutar el firmware paso a paso como se explica en la secci\u00f3n \u201cC\u00f3mo funciona el nodo\u201d. En el siguiente v\u00eddeo pod\u00e9is ver c\u00f3mo se realiza el \u201cinicio del im\u00e1n\u201d: inicio del im\u00e1n. Figura 7.4.1: Uso del im\u00e1n para iniciar el nodo 7.5 Ejemplo de trabajo El siguiente diagrama explica c\u00f3mo funciona el programa del nodo cuando el nodo est\u00e1 instalado y se inicia cuando el espacio de estacionamiento est\u00e1 libre. En la columna de la izquierda se puede ver el estado de las plazas de aparcamiento durante la ejecuci\u00f3n. En el lado derecho puede ver los tipos de tramas que se env\u00edan a Libelium Cloud dependiendo de los cambios de estado de las plazas de estacionamiento, el tiempo transcurrido y los cambios de configuraci\u00f3n del usuario. Figura 7.5.1: Ejemplo de funcionamiento del nodo Smart Parking 7.6 C\u00f3mo reemplazar la bater\u00eda Procedimiento de reemplazo de la bater\u00eda 8 Certificaciones 8.1 CE (Uni\u00f3n Europea) Ir a Declaraci\u00f3n de conformidad CE 8.2 FCC (Estados Unidos) \u201cSmart Parking v2 US\u201d cumple con el T\u00edtulo 47 Parte 15 subparte B de las reglas y regulaciones de la FCC para dispositivos de radiofrecuencia: radiadores no intencionales (2019). Este dispositivo contiene los siguientes m\u00f3dulos transmisores: [LISTA] FCC ID: T9JRN2903 [LISTA] FCC ID: 2AQ6KA1 8.3 UKCA (Reino Unido) Vaya a la Declaraci\u00f3n de conformidad de UKCA 8.4 IP68 (EN 60529) \u201cSmart Parking v2\u201d fue probado de acuerdo con los est\u00e1ndares UNEEN 60529:2018 + /A1:2018 + /A2:2018 (EN 60529:1991 + Errata:1993 + /A1:2000 + /A2:2013). Protecci\u00f3n contra objetos s\u00f3lidos extra\u00f1os El nodo fue introducido dentro de una c\u00e1mara de polvo IP6X durante 8 horas, con talco de 2 kg/m y una depresi\u00f3n de presi\u00f3n interna de 20 mbar. Despu\u00e9s de las pruebas, no se encontraron rastros de polvo dentro de la carcasa, lo que demuestra un grado de protecci\u00f3n IP6X. IP6X es la clasificaci\u00f3n m\u00e1xima de protecci\u00f3n contra objetos s\u00f3lidos extra\u00f1os. Protecci\u00f3n contra la entrada de agua El nodo se introdujo dentro de un tanque de inmersi\u00f3n durante 30 minutos. Esta prueba se realiz\u00f3 con el punto m\u00e1s bajo del recinto a 1,2 m por debajo de la superficie del agua. Despu\u00e9s de las pruebas, no se observaron rastros de agua dentro del gabinete, lo que demuestra un grado de protecci\u00f3n IPX8. IPX8 es la clasificaci\u00f3n m\u00e1xima de protecci\u00f3n contra la entrada de agua. 8.5 IK10 (EN 50102) \u201cSmart Parking v2\u201d ha sido probado seg\u00fan las normas UNEEN 50102:1996 + A1:1999 + Corr:2002 + A1 CORR:2002 (EN 62262:2002). el nodo fue sometido a impactos de 20 J en varios puntos del recinto (el equivalente al impacto de una masa de 5 kg lanzada desde 400 mm de altura sobre la superficie impactada). Despu\u00e9s de las pruebas, no se observaron grietas ni agujeros en las muestras analizadas, lo que demuestra un grado de protecci\u00f3n IK10. IK10 es la calificaci\u00f3n m\u00e1xima de protecci\u00f3n contra impactos mec\u00e1nicos externos. Si desea obtener m\u00e1s informaci\u00f3n sobre las certificaciones, consulte aqu\u00ed. 9 Mantenimiento [LISTA] En este apartado el t\u00e9rmino \u201cAparcamiento Inteligente\u201d engloba tanto al propio dispositivo como a sus accesorios. [LISTA] Aunque Smart Parking es un producto muy resistente, se ruega manipularlo con cuidado para disfrutar de una vida \u00fatil m\u00e1s larga. [LISTA] Maneje Smart Parking con cuidado, no permita que se caiga o se mueva bruscamente. [LISTA] Evite colocar los dispositivos en \u00e1reas que alcancen altas temperaturas que puedan da\u00f1ar los componentes electr\u00f3nicos. [LISTA] Evite ambientes agresivos (gases corrosivos, animales, humedad excesiva/condensante o atm\u00f3sferas con sal suspendida en el aire). [LISTA] La antena y la bater\u00eda se conectan suavemente a sus conectores, no fuerces al instalar o podr\u00edas da\u00f1ar el conector. [LISTA] Enchufe la antena o bater\u00eda \u00fanicamente en sus conectores correspondientes. [LISTA] No utilice ning\u00fan tipo de pintura en el dispositivo, podr\u00eda afectar el funcionamiento de los mecanismos de cierre. [LISTA] Para la limpieza utilizar un pa\u00f1o h\u00famedo, no productos qu\u00edmicos agresivos. 10 Eliminaci\u00f3n y reciclaje [LISTA] Cuando Smart Parking llegue al final de su vida \u00fatil podr\u00e1s contactar con el departamento comercial de Libelium para solicitar su sustituci\u00f3n. [LISTA] En caso de no desear ser utilizado m\u00e1s se debe llevar a un punto de reciclaje de equipos electr\u00f3nicos. [LISTA] El equipo debe eliminarse por separado de los residuos s\u00f3lidos urbanos, por favor desechar correctamente. [LISTA] Su distribuidor le asesorar\u00e1 sobre la forma m\u00e1s adecuada y respetuosa con el medio ambiente de eliminar el producto y su embalaje.  11 Gu\u00edas de seguridad 11.1 Cartucho de fijaci\u00f3n qu\u00edmica Smart Parking 12 Registro de cambios en la documentaci\u00f3n De v8.0 a v8.1: [LISTA] Se modific\u00f3 el rango de umbral del radar y el valor predeterminado [LISTA] Se elimin\u00f3 la columna de recalibraci\u00f3n del radar del ejemplo del marco de informaci\u00f3n [LISTA] Se agreg\u00f3 informaci\u00f3n sobre v1. Versiones de firmware 2.x De v7.9 a v8.0: [LISTA] Informaci\u00f3n agregada sobre la nueva Estaci\u00f3n Base Libelium LoRaWAN De v7.9 a v8.0: [LISTA] Informaci\u00f3n agregada sobre la nueva Nube Libelium [LISTA] Referencias eliminadas al Servidor de Clientes descontinuado [LISTA] Informaci\u00f3n eliminada sobre el formato de marcos [LISTA] A\u00f1adida notas sobre el Fin de Vida de los servidores de red TTN y TTI, y el fin del soporte de Libelium para ellos De v7.8 a v7.9: [LISTA] La temperatura m\u00e1xima de operaci\u00f3n volvi\u00f3 a +65 \u00baC, ya que por encima de esta temperatura pueden aparecer fallos de funcionamiento A partir de v7 .7 a v7.8: [LISTA] Se agreg\u00f3 informaci\u00f3n sobre las versiones de firmware v1.0.7 y v1.1.2 que aumentan el rango de tiempo de suspensi\u00f3n hasta 10 segundos. De v7.6 a v7.7: [LISTA] Se agreg\u00f3 informaci\u00f3n sobre v1.0 Versiones de firmware .x y v1.1.x De v7.5 a v7.6: [LISTA] Se agreg\u00f3 informaci\u00f3n sobre la certificaci\u00f3n IP68 (protecci\u00f3n contra la entrada de polvo y agua) [LISTA] Se agreg\u00f3 informaci\u00f3n sobre la certificaci\u00f3n IK10 (protecci\u00f3n contra impactos) [LISTA] La temperatura m\u00e1xima de funcionamiento aument\u00f3 a +85 \u00baC (no continuamente) De v7.4 a v7.5: [LISTA] Se desaprob\u00f3 la configuraci\u00f3n \u201cKeepalive nightmode\u201d en todos los formularios de configuraci\u00f3n: Smart Parking Cloud Service, Customer Server y Smart Devices App [ LISTA] Se agreg\u00f3 una nueva secci\u00f3n para describir la etiqueta del Nodo de estacionamiento inteligente con las especificaciones del dispositivo. [LISTA] Se actualizaron todas las versiones de firmware publicadas de v7.3 a v7.4: [LISTA] Se agreg\u00f3 informaci\u00f3n para permitir la integraci\u00f3n de los siguientes 3 servidores de red LoRaWAN en el Escenario de \u201cServicio de nube de estacionamiento inteligente\u201d: The Things Network, The Things Industries y el servidor de red integrado de la estaci\u00f3n base MultiTech De v7.2 a v7.3: [LISTA] Se agreg\u00f3 informaci\u00f3n para permitir la integraci\u00f3n de los siguientes 3 servidores de red LoRaWAN en el \u201cCliente Escenario de servidor: The Things Network, The Things Industries y el servidor de red integrado de la estaci\u00f3n base MultiTech [LISTA] Se agreg\u00f3 diagrama y dimensiones del gabinete abovedado [LISTA] Se agreg\u00f3 informaci\u00f3n sobre el servidor del cliente: m\u00faltiples instancias, informaci\u00f3n de extracci\u00f3n y actualizaci\u00f3n [LISTA] Correcci\u00f3n de erratas De v7.1 a v7.2: [LISTA] Se agreg\u00f3 una recomendaci\u00f3n de tipo de licencia de Loriot [LISTA] Se cambi\u00f3 el formato de importaci\u00f3n por lotes de Loriot debido al nuevo Loriot Network Server 5.0 De v7.0 a v7.1: [LISTA] Se agreg\u00f3 una gu\u00eda de seguridad para Smart Cartucho de fijaci\u00f3n qu\u00edmica de estacionamiento [LISTA] Correcci\u00f3n de erratas"}